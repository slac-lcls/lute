<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="GFD, VM" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>elog - LUTE</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "elog";
        var mkdocs_page_input_path = "source/io/elog.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> LUTE
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../usage/">Quick Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Walkthroughs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorial/new_task/">Creating a new Task</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorial/creating_workflows/">Creating a new Workflow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Source Code</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../managed_tasks/">managed_tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >execution</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../execution/executor/">executor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../execution/ipc/">ipc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../execution/debug_utils/">debug_utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >tasks</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../tasks/task/">task</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../tasks/dataclasses/">dataclasses</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../tasks/sfx_find_peaks/">sfx_find_peaks</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../tasks/sfx_index/">sfx_index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../tasks/test/">test</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >io</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" >models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../models/base/">base</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/sfx_find_peaks/">sfx_find_peaks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/sfx_index/">sfx_index</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/sfx_merge/">sfx_merge</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/sfx_solve/">sfx_solve</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/smd/">smd</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/tests/">tests</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../config/">config</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../db/">db</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../_sqlite/">_sqlite</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">elog</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exceptions/">exceptions</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Design and Specifications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../design/database/">Database</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">LUTE</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Source Code</li>
          <li class="breadcrumb-item">io</li>
      <li class="breadcrumb-item active">elog</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/slac-lcls/lute/edit/master/docs/source/io/elog.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="io.elog"></a>
    <div class="doc doc-contents first">

      <p>Provides utilities for communicating with the LCLS eLog.</p>
<p>Make use of various eLog API endpoint to retrieve information or post results.</p>


<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.get_elog_opr_auth" href="#io.elog.get_elog_opr_auth">get_elog_opr_auth</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str): Return an authorization object to interact with
eLog API as an opr account for the hutch where <code>exp</code> was conducted.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.get_elog_kerberos_auth" href="#io.elog.get_elog_kerberos_auth">get_elog_kerberos_auth</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Return the authorization headers for the user account
submitting the job.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.elog_http_request" href="#io.elog.elog_http_request">elog_http_request</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str, request_type: str, **params): Make an HTTP
request to the API endpoint at <code>url</code>.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.format_file_for_post" href="#io.elog.format_file_for_post">format_file_for_post</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Union[str, tuple, list]): Prepare files
according to the specification needed to add them as attachments to eLog
posts.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.post_elog_message" href="#io.elog.post_elog_message">post_elog_message</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str, msg: str, tag: Optional[str],
              title: Optional[str],
              in_files: List[Union[str, tuple, list]],
              auth: Optional[Union[HTTPBasicAuth, Dict]] = None)
Post a message to the eLog.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.post_elog_run_status" href="#io.elog.post_elog_run_status">post_elog_run_status</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Dict[str, Union[str, int, float]],
                 update_url: Optional[str] = None)
Post a run status to the summary section on the Workflows&gt;Control tab.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.post_elog_run_table" href="#io.elog.post_elog_run_table">post_elog_run_table</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str, run: int, data: Dict[str, Any],
               auth: Optional[Union[HTTPBasicAuth, Dict]] = None)
Update run table in the eLog.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.get_elog_runs_by_tag" href="#io.elog.get_elog_runs_by_tag">get_elog_runs_by_tag</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str, tag: str,
                 auth: Optional[Union[HTTPBasicAuth, Dict]] = None)
Return a list of runs with a specific tag.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="io.elog.get_elog_params_by_run" href="#io.elog.get_elog_params_by_run">get_elog_params_by_run</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str, params: List[str], runs: Optional[List[int]])
Retrieve the requested parameters by run. If no run is provided, retrieve
the requested parameters for all runs.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="io.elog.elog_http_request" class="doc doc-heading">
            <code class="highlight language-python">elog_http_request(exp, endpoint, request_type, **params)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Make an HTTP request to the eLog.</p>
<p>This method will determine the proper authorization method and update the
passed parameters appropriately. Functions implementing specific endpoint
functionality and calling this function should only pass the necessary
endpoint-specific parameters and not include the authorization objects.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Experiment.</p>
              </div>
            </li>
            <li>
              <b><code>endpoint</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>eLog API endpoint.</p>
              </div>
            </li>
            <li>
              <b><code>request_type</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Type of request to make. Recognized options: POST or
GET.</p>
              </div>
            </li>
            <li>
              <b><code>**params</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Endpoint parameters to pass with the HTTP request!
Differs depending on the API endpoint. Do not include auth objects.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>status_code</code></b>(                  <code>int</code>
)              –
              <div class="doc-md-description">
                <p>Response status code. Can be checked for errors.</p>
              </div>
            </li>
            <li>
<b><code>msg</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>An error message, or a message saying SUCCESS.</p>
              </div>
            </li>
            <li>
<b><code>value</code></b>(                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
)              –
              <div class="doc-md-description">
                <p>For GET requests ONLY, return the requested
information.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def elog_http_request(
    exp: str, endpoint: str, request_type: str, **params
) -&gt; Tuple[int, str, Optional[Any]]:
    """Make an HTTP request to the eLog.

    This method will determine the proper authorization method and update the
    passed parameters appropriately. Functions implementing specific endpoint
    functionality and calling this function should only pass the necessary
    endpoint-specific parameters and not include the authorization objects.

    Args:
        exp (str): Experiment.

        endpoint (str): eLog API endpoint.

        request_type (str): Type of request to make. Recognized options: POST or
            GET.

        **params (Dict): Endpoint parameters to pass with the HTTP request!
            Differs depending on the API endpoint. Do not include auth objects.

    Returns:
        status_code (int): Response status code. Can be checked for errors.

        msg (str): An error message, or a message saying SUCCESS.

        value (Optional[Any]): For GET requests ONLY, return the requested
            information.
    """
    auth: Union[HTTPBasicAuth, Dict[str, str]] = get_elog_auth(exp)
    base_url: str
    if isinstance(auth, HTTPBasicAuth):
        params.update({"auth": auth})
        base_url = "https://pswww.slac.stanford.edu/ws-auth/lgbk/lgbk"
    elif isinstance(auth, dict):
        params.update({"headers": auth})
        base_url = "https://pswww.slac.stanford.edu/ws-kerb/lgbk/lgbk"

    url: str = f"{base_url}/{endpoint}"

    resp: requests.models.Response
    if request_type.upper() == "POST":
        resp = requests.post(url, **params)
    elif request_type.upper() == "GET":
        resp = requests.get(url, **params)
    else:
        return (-1, "Invalid request type!", None)

    status_code: int = resp.status_code
    msg: str = "SUCCESS"

    if resp.json()["success"] and request_type.upper() == "GET":
        return (status_code, msg, resp.json()["value"])

    if status_code &gt;= 300:
        msg = f"Error when posting to eLog: Response {status_code}"

    if not resp.json()["success"]:
        err_msg = resp.json()["error_msg"]
        msg += f"\nInclude message: {err_msg}"
    return (resp.status_code, msg, None)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.format_file_for_post" class="doc doc-heading">
            <code class="highlight language-python">format_file_for_post(in_file)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Format a file for attachment to an eLog post.</p>
<p>The eLog API expects a specifically formatted tuple when adding file
attachments. This function prepares the tuple to specification given a
number of different input types.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>in_file</code></b>
                  (<code>str | tuple | list</code>)
              –
              <div class="doc-md-description">
                <p>File to include as an attachment in an
eLog post.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def format_file_for_post(
    in_file: Union[str, tuple, list]
) -&gt; Tuple[str, Tuple[str, BufferedReader], Any]:
    """Format a file for attachment to an eLog post.

    The eLog API expects a specifically formatted tuple when adding file
    attachments. This function prepares the tuple to specification given a
    number of different input types.

    Args:
        in_file (str | tuple | list): File to include as an attachment in an
            eLog post.
    """
    description: str
    fptr: BufferedReader
    ftype: Optional[str]
    if isinstance(in_file, str):
        description = os.path.basename(in_file)
        fptr = open(in_file, "rb")
        ftype = mimetypes.guess_type(in_file)[0]
    elif isinstance(in_file, tuple) or isinstance(in_file, list):
        description = in_file[1]
        fptr = open(in_file[0], "rb")
        ftype = mimetypes.guess_type(in_file[0])[0]
    else:
        raise ElogFileFormatError(f"Unrecognized format: {in_file}")

    out_file: Tuple[str, Tuple[str, BufferedReader], Any] = (
        "files",
        (description, fptr),
        ftype,
    )
    return out_file</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_active_expmt" class="doc doc-heading">
            <code class="highlight language-python">get_elog_active_expmt(hutch, *, endstation=0)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Get the current active experiment for a hutch.</p>
<p>This function is one of two functions to manage the HTTP request independently.
This is because it does not require an authorization object, and its result
is needed for the generic function <code>elog_http_request</code> to work properly.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>hutch</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The hutch to get the active experiment for.</p>
              </div>
            </li>
            <li>
              <b><code>endstation</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>The hutch endstation to get the experiment for. This
should generally be 0.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_active_expmt(hutch: str, *, endstation: int = 0) -&gt; str:
    """Get the current active experiment for a hutch.

    This function is one of two functions to manage the HTTP request independently.
    This is because it does not require an authorization object, and its result
    is needed for the generic function `elog_http_request` to work properly.

    Args:
        hutch (str): The hutch to get the active experiment for.

        endstation (int): The hutch endstation to get the experiment for. This
            should generally be 0.
    """

    base_url: str = "https://pswww.slac.stanford.edu/ws/lgbk/lgbk"
    endpoint: str = "ws/activeexperiment_for_instrument_station"
    url: str = f"{base_url}/{endpoint}"
    params: Dict[str, str] = {"instrument_name": hutch, "station": f"{endstation}"}
    resp: requests.models.Response = requests.get(url, params)
    if resp.status_code &gt; 300:
        raise RuntimeError(
            f"Error getting current experiment!\n\t\tIncorrect hutch: '{hutch}'?"
        )
    if resp.json()["success"]:
        return resp.json()["value"]["name"]
    else:
        msg: str = resp.json()["error_msg"]
        raise RuntimeError(f"Error getting current experiment! Err: {msg}")</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_auth" class="doc doc-heading">
            <code class="highlight language-python">get_elog_auth(exp)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Determine the appropriate auth method depending on experiment state.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>auth</code></b>(                  <code><span title="requests.auth.HTTPBasicAuth">HTTPBasicAuth</span> | <span title="typing.Dict">Dict</span>[str, str]</code>
)              –
              <div class="doc-md-description">
                <p>Depending on whether an experiment
is active/live, returns authorization for the hutch operator account
or the current user submitting a job.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_auth(exp: str) -&gt; Union[HTTPBasicAuth, Dict[str, str]]:
    """Determine the appropriate auth method depending on experiment state.

    Returns:
        auth (HTTPBasicAuth | Dict[str, str]): Depending on whether an experiment
            is active/live, returns authorization for the hutch operator account
            or the current user submitting a job.
    """
    hutch: str = exp[:3]
    if exp.lower() == get_elog_active_expmt(hutch=hutch).lower():
        return get_elog_opr_auth(exp)
    else:
        return get_elog_kerberos_auth()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_kerberos_auth" class="doc doc-heading">
            <code class="highlight language-python">get_elog_kerberos_auth()</code>

</h2>


    <div class="doc doc-contents ">

      <p>Returns Kerberos authorization key.</p>
<p>This functions returns authorization for the USER account submitting jobs.
It assumes that <code>kinit</code> has been run.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>auth</code></b>(                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
)              –
              <div class="doc-md-description">
                <p>Dictionary containing Kerberos authorization key.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_kerberos_auth() -&gt; Dict[str, str]:
    """Returns Kerberos authorization key.

    This functions returns authorization for the USER account submitting jobs.
    It assumes that `kinit` has been run.

    Returns:
        auth (Dict[str, str]): Dictionary containing Kerberos authorization key.
    """
    from krtc import KerberosTicket

    return KerberosTicket("HTTP@pswww.slac.stanford.edu").getAuthHeaders()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_opr_auth" class="doc doc-heading">
            <code class="highlight language-python">get_elog_opr_auth(exp)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Produce authentication for the "opr" user associated to an experiment.</p>
<p>This method uses basic authentication using username and password.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the experiment to produce authentication for.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>auth</code></b>(                  <code><span title="requests.auth.HTTPBasicAuth">HTTPBasicAuth</span></code>
)              –
              <div class="doc-md-description">
                <p>HTTPBasicAuth for an active experiment based on
username and password for the associated operator account.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_opr_auth(exp: str) -&gt; HTTPBasicAuth:
    """Produce authentication for the "opr" user associated to an experiment.

    This method uses basic authentication using username and password.

    Args:
        exp (str): Name of the experiment to produce authentication for.

    Returns:
        auth (HTTPBasicAuth): HTTPBasicAuth for an active experiment based on
            username and password for the associated operator account.
    """
    opr: str = f"{exp[:3]}opr"
    with open("/sdf/group/lcls/ds/tools/forElogPost.txt", "r") as f:
        pw: str = f.readline()[:-1]
    return HTTPBasicAuth(opr, pw)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_params_by_run" class="doc doc-heading">
            <code class="highlight language-python">get_elog_params_by_run(exp, params, runs=None)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Retrieve requested parameters by run or for all runs.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Experiment to retrieve parameters for.</p>
              </div>
            </li>
            <li>
              <b><code>params</code></b>
                  (<code><span title="typing.List">List</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>A list of parameters to retrieve. These can be any
parameter recorded in the eLog (PVs, parameters posted by other
Tasks, etc.)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_params_by_run(
    exp: str, params: List[str], runs: Optional[List[int]] = None
) -&gt; Dict[str, str]:
    """Retrieve requested parameters by run or for all runs.

    Args:
        exp (str): Experiment to retrieve parameters for.

        params (List[str]): A list of parameters to retrieve. These can be any
            parameter recorded in the eLog (PVs, parameters posted by other
            Tasks, etc.)
    """
    ...</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_runs_by_tag" class="doc doc-heading">
            <code class="highlight language-python">get_elog_runs_by_tag(exp, tag, auth=None)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Retrieve run numbers with a specified tag.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Experiment name.</p>
              </div>
            </li>
            <li>
              <b><code>tag</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The tag to retrieve runs for.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_runs_by_tag(
    exp: str, tag: str, auth: Optional[Union[HTTPBasicAuth, Dict]] = None
) -&gt; List[int]:
    """Retrieve run numbers with a specified tag.

    Args:
        exp (str): Experiment name.

        tag (str): The tag to retrieve runs for.
    """
    endpoint: str = f"{exp}/ws/get_runs_with_tag?tag={tag}"
    params: Dict[str, Any] = {}

    status_code, resp_msg, tagged_runs = elog_http_request(
        exp=exp, endpoint=endpoint, request_type="GET", **params
    )

    if not tagged_runs:
        tagged_runs = []

    return tagged_runs</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.get_elog_workflows" class="doc doc-heading">
            <code class="highlight language-python">get_elog_workflows(exp)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Get the current workflow definitions for an experiment.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>defns</code></b>(                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
)              –
              <div class="doc-md-description">
                <p>A dictionary of workflow definitions.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_elog_workflows(exp: str) -&gt; Dict[str, str]:
    """Get the current workflow definitions for an experiment.

    Returns:
        defns (Dict[str, str]): A dictionary of workflow definitions.
    """
    raise NotImplementedError</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.post_elog_message" class="doc doc-heading">
            <code class="highlight language-python">post_elog_message(exp, msg, *, tag, title, in_files=[])</code>

</h2>


    <div class="doc doc-contents ">

      <p>Post a new message to the eLog. Inspired by the <code>elog</code> package.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Experiment name.</p>
              </div>
            </li>
            <li>
              <b><code>msg</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>BODY of the eLog post.</p>
              </div>
            </li>
            <li>
              <b><code>tag</code></b>
                  (<code>str | None</code>)
              –
              <div class="doc-md-description">
                <p>Optional "tag" to associate with the eLog post.</p>
              </div>
            </li>
            <li>
              <b><code>title</code></b>
                  (<code>str | None</code>)
              –
              <div class="doc-md-description">
                <p>Optional title to include in the eLog post.</p>
              </div>
            </li>
            <li>
              <b><code>in_files</code></b>
                  (<code><span title="typing.List">List</span>[str | tuple | list]</code>, default:
                      <code>[]</code>
)
              –
              <div class="doc-md-description">
                <p>Files to include as attachments in
the eLog post.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>err_msg</code></b>(                  <code>str | None</code>
)              –
              <div class="doc-md-description">
                <p>If successful, nothing is returned, otherwise,
return an error message.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def post_elog_message(
    exp: str,
    msg: str,
    *,
    tag: Optional[str],
    title: Optional[str],
    in_files: List[Union[str, tuple, list]] = [],
) -&gt; Optional[str]:
    """Post a new message to the eLog. Inspired by the `elog` package.

    Args:
        exp (str): Experiment name.

        msg (str): BODY of the eLog post.

        tag (str | None): Optional "tag" to associate with the eLog post.

        title (str | None): Optional title to include in the eLog post.

        in_files (List[str | tuple | list]): Files to include as attachments in
            the eLog post.

    Returns:
        err_msg (str | None): If successful, nothing is returned, otherwise,
            return an error message.
    """
    # MOSTLY CORRECT
    out_files: list = []
    for f in in_files:
        try:
            out_files.append(format_file_for_post(in_file=f))
        except ElogFileFormatError as err:
            logger.debug(f"ElogFileFormatError: {err}")
    post: Dict[str, str] = {}
    post["log_text"] = msg
    if tag:
        post["log_tags"] = tag
    if title:
        post["log_title"] = title

    endpoint: str = f"{exp}/ws/new_elog_entry"

    params: Dict[str, Any] = {"data": post}

    if out_files:
        params.update({"files": out_files})

    status_code, resp_msg, _ = elog_http_request(
        exp=exp, endpoint=endpoint, request_type="POST", **params
    )

    if resp_msg != "SUCCESS":
        return resp_msg</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.post_elog_run_status" class="doc doc-heading">
            <code class="highlight language-python">post_elog_run_status(data, update_url=None)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Post a summary to the status/report section of a specific run.</p>
<p>In contrast to most eLog update/post mechanisms, this function searches
for a specific environment variable which contains a specific URL for
posting. This is updated every job/run as jobs are submitted by the JID.
The URL can optionally be passed to this function if it is known.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]</code>)
              –
              <div class="doc-md-description">
                <p>The data to post to the eLog
report section. Formatted in key:value pairs.</p>
              </div>
            </li>
            <li>
              <b><code>update_url</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional update URL. If not provided, the
function searches for the corresponding environment variable. If
neither is found, the function aborts</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def post_elog_run_status(
    data: Dict[str, Union[str, int, float]], update_url: Optional[str] = None
) -&gt; None:
    """Post a summary to the status/report section of a specific run.

    In contrast to most eLog update/post mechanisms, this function searches
    for a specific environment variable which contains a specific URL for
    posting. This is updated every job/run as jobs are submitted by the JID.
    The URL can optionally be passed to this function if it is known.

    Args:
        data (Dict[str, Union[str, int, float]]): The data to post to the eLog
            report section. Formatted in key:value pairs.

        update_url (Optional[str]): Optional update URL. If not provided, the
            function searches for the corresponding environment variable. If
            neither is found, the function aborts
    """
    if update_url is None:
        update_url = os.environ.get("JID_UPDATE_COUNTERS")
        if update_url is None:
            logger.info("eLog Update Failed! JID_UPDATE_COUNTERS is not defined!")
            return
    current_status: Dict[str, Union[str, int, float]] = _get_current_run_status(
        update_url
    )
    current_status.update(data)
    post_list: List[Dict[str, str]] = [
        {"key": f"{key}", "value": f"{value}"} for key, value in current_status.items()
    ]
    params: Dict[str, List[Dict[str, str]]] = {"json": post_list}
    resp: requests.models.Response = requests.post(update_url, **params)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.post_elog_run_table" class="doc doc-heading">
            <code class="highlight language-python">post_elog_run_table(exp, run, data)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Post data for eLog run tables.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exp</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Experiment name.</p>
              </div>
            </li>
            <li>
              <b><code>run</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Run number corresponding to the data being posted.</p>
              </div>
            </li>
            <li>
              <b><code>data</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>Data to be posted in format
data["column_header"] = value.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>err_msg</code></b>(                  <code>None | str</code>
)              –
              <div class="doc-md-description">
                <p>If successful, nothing is returned, otherwise,
return an error message.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def post_elog_run_table(
    exp: str,
    run: int,
    data: Dict[str, Any],
) -&gt; Optional[str]:
    """Post data for eLog run tables.

    Args:
        exp (str): Experiment name.

        run (int): Run number corresponding to the data being posted.

        data (Dict[str, Any]): Data to be posted in format
            data["column_header"] = value.

    Returns:
        err_msg (None | str): If successful, nothing is returned, otherwise,
            return an error message.
    """
    endpoint: str = f"run_control/{exp}/ws/add_run_params"

    params: Dict[str, Any] = {"params": {"run_num": run}, "json": data}

    status_code, resp_msg, _ = elog_http_request(
        exp=exp, endpoint=endpoint, request_type="POST", **params
    )

    if resp_msg != "SUCCESS":
        return resp_msg</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="io.elog.post_elog_workflow" class="doc doc-heading">
            <code class="highlight language-python">post_elog_workflow(exp, name, executable, wf_params, *, trigger='run_end', location='S3DF', **trig_args)</code>

</h2>


    <div class="doc doc-contents ">

      <p>Create a new eLog workflow, or update an existing one.</p>
<p>The workflow will run a specific executable as a batch job when the
specified trigger occurs. The precise arguments may vary depending on the
selected trigger type.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>An identifying name for the workflow. E.g. "process data"</p>
              </div>
            </li>
            <li>
              <b><code>executable</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Full path to the executable to be run.</p>
              </div>
            </li>
            <li>
              <b><code>wf_params</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>All command-line parameters for the executable as a string.</p>
              </div>
            </li>
            <li>
              <b><code>trigger</code></b>
                  (<code>str</code>, default:
                      <code>&#39;run_end&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>When to trigger execution of the specified executable.
One of:
    - 'manual': Must be manually triggered. No automatic processing.
    - 'run_start': Execute immediately if a new run begins.
    - 'run_end': As soon as a run ends.
    - 'param_is': As soon as a parameter has a specific value for a run.</p>
              </div>
            </li>
            <li>
              <b><code>location</code></b>
                  (<code>str</code>, default:
                      <code>&#39;S3DF&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Where to submit the job. S3DF or NERSC.</p>
              </div>
            </li>
            <li>
              <b><code>**trig_args</code></b>
                  (<code>str</code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Arguments required for a specific trigger type.
trigger='param_is' - 2 Arguments
    trig_param (str): Name of the parameter to watch for.
    trig_param_val (str): Value the parameter should have to trigger.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>lute/io/elog.py</code></summary>
              <pre class="highlight"><code class="language-python">def post_elog_workflow(
    exp: str,
    name: str,
    executable: str,
    wf_params: str,
    *,
    trigger: str = "run_end",
    location: str = "S3DF",
    **trig_args: str,
) -&gt; None:
    """Create a new eLog workflow, or update an existing one.

    The workflow will run a specific executable as a batch job when the
    specified trigger occurs. The precise arguments may vary depending on the
    selected trigger type.

    Args:
        name (str): An identifying name for the workflow. E.g. "process data"

        executable (str): Full path to the executable to be run.

        wf_params (str): All command-line parameters for the executable as a string.

        trigger (str): When to trigger execution of the specified executable.
            One of:
                - 'manual': Must be manually triggered. No automatic processing.
                - 'run_start': Execute immediately if a new run begins.
                - 'run_end': As soon as a run ends.
                - 'param_is': As soon as a parameter has a specific value for a run.

        location (str): Where to submit the job. S3DF or NERSC.

        **trig_args (str): Arguments required for a specific trigger type.
            trigger='param_is' - 2 Arguments
                trig_param (str): Name of the parameter to watch for.
                trig_param_val (str): Value the parameter should have to trigger.
    """
    endpoint: str = f"{exp}/ws/create_update_workflow_def"
    trig_map: Dict[str, str] = {
        "manual": "MANUAL",
        "run_start": "START_OF_RUN",
        "run_end": "END_OF_RUN",
        "param_is": "RUN_PARAM_IS_VALUE",
    }
    if trigger not in trig_map.keys():
        raise NotImplementedError(
            f"Cannot create workflow with trigger type: {trigger}"
        )
    wf_defn: Dict[str, str] = {
        "name": name,
        "executable": executable,
        "parameters": wf_params,
        "trigger": trig_map[trigger],
        "location": location,
    }
    if trigger == "param_is":
        if "trig_param" not in trig_args or "trig_param_val" not in trig_args:
            raise RuntimeError(
                "Trigger type 'param_is' requires: 'trig_param' and 'trig_param_val' arguments"
            )
        wf_defn.update(
            {
                "run_param_name": trig_args["trig_param"],
                "run_param_val": trig_args["trig_param_val"],
            }
        )
    post_params: Dict[str, Dict[str, str]] = {"json": wf_defn}
    status_code, resp_msg, _ = elog_http_request(
        exp, endpoint=endpoint, request_type="POST", **post_params
    )</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../_sqlite/" class="btn btn-neutral float-left" title="_sqlite"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../exceptions/" class="btn btn-neutral float-right" title="exceptions">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>© 2024 LCLS</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/slac-lcls/lute" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../_sqlite/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../exceptions/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
