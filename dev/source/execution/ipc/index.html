
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="GFD, VM">
      
      
      
        <link rel="prev" href="../executor/">
      
      
        <link rel="next" href="../debug_utils/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.21">
    
    
      
        <title>ipc - LUTE</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#execution.ipc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LUTE" class="md-header__button md-logo" aria-label="LUTE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUTE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ipc
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/slac-lcls/lute" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LUTE" class="md-nav__button md-logo" aria-label="LUTE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LUTE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/slac-lcls/lute" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Walkthroughs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Walkthroughs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/new_task/" class="md-nav__link">
        Creating a new Task
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/creating_workflows/" class="md-nav__link">
        Creating a new Workflow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Source Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Source Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../managed_tasks/" class="md-nav__link">
        managed_tasks
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          execution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          execution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../executor/" class="md-nav__link">
        executor
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ipc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ipc
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#execution.ipc" class="md-nav__link">
    ipc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.Communicator" class="md-nav__link">
    Communicator
  </a>
  
    <nav class="md-nav" aria-label="Communicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.clear_communicator" class="md-nav__link">
    clear_communicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.stage_communicator" class="md-nav__link">
    stage_communicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.Party" class="md-nav__link">
    Party
  </a>
  
    <nav class="md-nav" aria-label="Party">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Party.EXECUTOR" class="md-nav__link">
    EXECUTOR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Party.TASK" class="md-nav__link">
    TASK
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator" class="md-nav__link">
    PipeCommunicator
  </a>
  
    <nav class="md-nav" aria-label="PipeCommunicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator" class="md-nav__link">
    SocketCommunicator
  </a>
  
    <nav class="md-nav" aria-label="SocketCommunicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.READ_TIMEOUT" class="md-nav__link">
    READ_TIMEOUT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug_utils/" class="md-nav__link">
        debug_utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          tasks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/task/" class="md-nav__link">
        task
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/dataclasses/" class="md-nav__link">
        dataclasses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/sfx_find_peaks/" class="md-nav__link">
        sfx_find_peaks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/sfx_index/" class="md-nav__link">
        sfx_index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/test/" class="md-nav__link">
        test
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          io
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          io
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
          models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4_1">
          <span class="md-nav__icon md-icon"></span>
          models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_find_peaks/" class="md-nav__link">
        sfx_find_peaks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_index/" class="md-nav__link">
        sfx_index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_merge/" class="md-nav__link">
        sfx_merge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_solve/" class="md-nav__link">
        sfx_solve
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/smd/" class="md-nav__link">
        smd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/tests/" class="md-nav__link">
        tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/db/" class="md-nav__link">
        db
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/_sqlite/" class="md-nav__link">
        _sqlite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/elog/" class="md-nav__link">
        elog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../io/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Design and Specifications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Design and Specifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/database/" class="md-nav__link">
        Database
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#execution.ipc" class="md-nav__link">
    ipc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.Communicator" class="md-nav__link">
    Communicator
  </a>
  
    <nav class="md-nav" aria-label="Communicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.clear_communicator" class="md-nav__link">
    clear_communicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.stage_communicator" class="md-nav__link">
    stage_communicator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Communicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.Party" class="md-nav__link">
    Party
  </a>
  
    <nav class="md-nav" aria-label="Party">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Party.EXECUTOR" class="md-nav__link">
    EXECUTOR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.Party.TASK" class="md-nav__link">
    TASK
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator" class="md-nav__link">
    PipeCommunicator
  </a>
  
    <nav class="md-nav" aria-label="PipeCommunicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.PipeCommunicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator" class="md-nav__link">
    SocketCommunicator
  </a>
  
    <nav class="md-nav" aria-label="SocketCommunicator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.READ_TIMEOUT" class="md-nav__link">
    READ_TIMEOUT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.read" class="md-nav__link">
    read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution.ipc.SocketCommunicator.write" class="md-nav__link">
    write
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>ipc</h1>

<div class="doc doc-object doc-module">



<a id="execution.ipc"></a>
    <div class="doc doc-contents first">

      <p>Classes and utilities for communication between Executors and subprocesses.</p>
<p>Communicators manage message passing and parsing between subprocesses. They
maintain a limited public interface of "read" and "write" operations. Behind
this interface the methods of communication vary from serialization across
pipes to Unix sockets, etc. All communicators pass a single object called a
"Message" which contains an arbitrary "contents" field as well as an optional
"signal" field.</p>
<p>Classes:</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="execution.ipc.Communicator" class="doc doc-heading">
            <code>Communicator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


              <details class="quote">
                <summary>Source code in <code>lute/execution/ipc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Communicator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Abstract Base Class for IPC Communicator objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">                managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>
<span class="sd">            use_pickle (bool): Whether to serialize data using pickle prior to</span>
<span class="sd">                sending it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_party</span> <span class="o">=</span> <span class="n">party</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="n">use_pickle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Communicator abstract base class.&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for reading data through the communication mechanism.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for sending data through the communication mechanism.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">stage_communicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alternative method for staging outside of context manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear_communicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alternative exit method outside of context manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="execution.ipc.Communicator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Abstract Base Class for IPC Communicator objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>party</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party" href="#execution.ipc.Party">Party</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which object (side/process) the Communicator is
managing IPC for. I.e., is this the "Task" or "Executor" side.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party.TASK" href="#execution.ipc.Party.TASK">TASK</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_pickle</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to serialize data using pickle prior to
sending it.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract Base Class for IPC Communicator objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">            managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>
<span class="sd">        use_pickle (bool): Whether to serialize data using pickle prior to</span>
<span class="sd">            sending it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_party</span> <span class="o">=</span> <span class="n">party</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="n">use_pickle</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Communicator abstract base class.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.Communicator.clear_communicator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_communicator</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Alternative exit method outside of context manager.</p>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_communicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative exit method outside of context manager.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.Communicator.read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Method for reading data through the communication mechanism.</p>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for reading data through the communication mechanism.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.Communicator.stage_communicator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stage_communicator</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Alternative method for staging outside of context manager.</p>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stage_communicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative method for staging outside of context manager.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.Communicator.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Method for sending data through the communication mechanism.</p>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for sending data through the communication mechanism.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="execution.ipc.Party" class="doc doc-heading">
            <code>Party</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


      <p>Identifier for which party (side/end) is using a communicator.</p>
<p>For some types of communication streams there may be different interfaces
depending on which side of the communicator you are on. This enum is used
by the communicator to determine which interface to use.</p>

              <details class="quote">
                <summary>Source code in <code>lute/execution/ipc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Party</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identifier for which party (side/end) is using a communicator.</span>

<span class="sd">    For some types of communication streams there may be different interfaces</span>
<span class="sd">    depending on which side of the communicator you are on. This enum is used</span>
<span class="sd">    by the communicator to determine which interface to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">TASK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Task (client) side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EXECUTOR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Executor (server) side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="execution.ipc.Party.EXECUTOR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">EXECUTOR</span> <span class="o">=</span> <span class="mi">1</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The Executor (server) side.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="execution.ipc.Party.TASK" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TASK</span> <span class="o">=</span> <span class="mi">0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The Task (client) side.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="execution.ipc.PipeCommunicator" class="doc doc-heading">
            <code>PipeCommunicator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="execution.ipc.Communicator" href="#execution.ipc.Communicator">Communicator</a></code></p>


      <p>Provides communication through pipes over stderr/stdout.</p>
<p>The implementation of this communicator has reading and writing ocurring
on stderr and stdout. In general the <code>Task</code> will be writing while the
<code>Executor</code> will be reading. <code>stderr</code> is used for sending signals.</p>

              <details class="quote">
                <summary>Source code in <code>lute/execution/ipc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PipeCommunicator</span><span class="p">(</span><span class="n">Communicator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides communication through pipes over stderr/stdout.</span>

<span class="sd">    The implementation of this communicator has reading and writing ocurring</span>
<span class="sd">    on stderr and stdout. In general the `Task` will be writing while the</span>
<span class="sd">    `Executor` will be reading. `stderr` is used for sending signals.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IPC through pipes.</span>

<span class="sd">        Arbitrary objects may be transmitted using pickle to serialize the data.</span>
<span class="sd">        If pickle is not used</span>

<span class="sd">        Args:</span>
<span class="sd">            party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">                managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>
<span class="sd">            use_pickle (bool): Whether to serialize data using Pickle prior to</span>
<span class="sd">                sending it. If False, data is assumed to be text whi</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">party</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="n">use_pickle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Communicates through stderr and stdout using pickle.&quot;</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read from stdout and stderr.</span>

<span class="sd">        Args:</span>
<span class="sd">            proc (subprocess.Popen): The process to read from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            msg (Message): The message read, containing contents and signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">raw_signal</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">raw_contents</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">raw_signal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="n">raw_signal</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="n">raw_signal</span>
        <span class="k">if</span> <span class="n">raw_contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PipeCommunicator (Executor) - Set _use_pickle=False&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_unpickle_decode</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">raw_contents</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PipeCommunicator (Executor) - Set _use_pickle=True&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_unpickle_decode</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">signal</span> <span class="ow">and</span> <span class="n">signal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LUTE_SIGNALS</span><span class="p">:</span>
            <span class="c1"># Some tasks write on stderr</span>
            <span class="c1"># If the signal channel has &quot;non-signal&quot; info, add it to</span>
            <span class="c1"># contents</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">signal</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">signal</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_safe_unpickle_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maybe_mixed</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method is used to unpickle and/or decode a bytes object.</span>

<span class="sd">        It attempts to handle cases where contents can be mixed, i.e., part of</span>
<span class="sd">        the message must be decoded and the other part unpickled. It handles</span>
<span class="sd">        only two-way splits. If there are more complex arrangements such as:</span>
<span class="sd">        &lt;pickled&gt;:&lt;unpickled&gt;:&lt;pickled&gt; etc, it will give up.</span>

<span class="sd">        The simpler two way splits are unlikely to occur in normal usage. They</span>
<span class="sd">        may arise when debugging if, e.g., `print` statements are mixed with the</span>
<span class="sd">        usage of the `_report_to_executor` method.</span>

<span class="sd">        Note that this method works because ONLY text data is assumed to be</span>
<span class="sd">        sent via the pipes. The method needs to be revised to handle non-text</span>
<span class="sd">        data if the `Task` is modified to also send that via PipeCommunicator.</span>
<span class="sd">        The use of pickle is supported to provide for this option if it is</span>
<span class="sd">        necessary. It may be deprecated in the future.</span>

<span class="sd">        Be careful when making changes. This method has seemingly redundant</span>
<span class="sd">        checks because unpickling will not throw an error if a full object can</span>
<span class="sd">        be retrieved. That is, the library will ignore extraneous bytes. This</span>
<span class="sd">        method attempts to retrieve that information if the pickled data comes</span>
<span class="sd">        first in the stream.</span>

<span class="sd">        Args:</span>
<span class="sd">            maybe_mixed (bytes): A bytes object which could require unpickling,</span>
<span class="sd">                decoding, or both.</span>

<span class="sd">        Returns:</span>
<span class="sd">            contents (Optional[str]): The unpickled/decoded contents if possible.</span>
<span class="sd">                Otherwise, None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">maybe_mixed</span><span class="p">)</span>
            <span class="n">repickled</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">repickled</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maybe_mixed</span><span class="p">):</span>
                <span class="c1"># Successful unpickling, but pickle stops even if there are more bytes</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">additional_data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">maybe_mixed</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">repickled</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contents</span><span class="si">}{</span><span class="n">additional_data</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="c1"># Can&#39;t decode the bytes left by pickle, so they are lost</span>
                    <span class="n">missing_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maybe_mixed</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">repickled</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;PipeCommunicator has truncated message. Unable to retrieve </span><span class="si">{</span><span class="n">missing_bytes</span><span class="si">}</span><span class="s2"> bytes.&quot;</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># Pickle may also throw a ValueError, e.g. this bytes: b&quot;Found! \n&quot;</span>
            <span class="c1"># Pickle may also throw an EOFError, eg. this bytes: b&quot;F0\n&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">maybe_mixed</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">maybe_mixed</span><span class="p">[:</span> <span class="n">err2</span><span class="o">.</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contents</span><span class="si">}{</span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">maybe_mixed</span><span class="p">[</span><span class="n">err2</span><span class="o">.</span><span class="n">start</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err3</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;PipeCommunicator unable to decode/parse data! </span><span class="si">{</span><span class="n">err3</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">contents</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write to stdout and stderr.</span>

<span class="sd">         The signal component is sent to `stderr` while the contents of the</span>
<span class="sd">         Message are sent to `stdout`.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (Message): The Message to send.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span><span class="p">:</span>
            <span class="n">signal</span><span class="p">:</span> <span class="nb">bytes</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="p">:</span>
                <span class="n">signal</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">signal</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

            <span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_signal</span><span class="p">:</span> <span class="nb">str</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="p">:</span>
                <span class="n">raw_signal</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">raw_signal</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">raw_contents</span><span class="p">:</span> <span class="nb">str</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">raw_contents</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">contents</span>
            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">raw_contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot send msg contents of type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span><span class="si">}</span><span class="s2"> when not using pickle!&quot;</span>
                <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw_signal</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="execution.ipc.PipeCommunicator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>IPC through pipes.</p>
<p>Arbitrary objects may be transmitted using pickle to serialize the data.
If pickle is not used</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>party</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party" href="#execution.ipc.Party">Party</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which object (side/process) the Communicator is
managing IPC for. I.e., is this the "Task" or "Executor" side.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party.TASK" href="#execution.ipc.Party.TASK">TASK</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_pickle</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to serialize data using Pickle prior to
sending it. If False, data is assumed to be text whi</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;IPC through pipes.</span>

<span class="sd">    Arbitrary objects may be transmitted using pickle to serialize the data.</span>
<span class="sd">    If pickle is not used</span>

<span class="sd">    Args:</span>
<span class="sd">        party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">            managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>
<span class="sd">        use_pickle (bool): Whether to serialize data using Pickle prior to</span>
<span class="sd">            sending it. If False, data is assumed to be text whi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">party</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="n">use_pickle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;Communicates through stderr and stdout using pickle.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.PipeCommunicator.read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read from stdout and stderr.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>proc</code></td>
            <td>
                  <code><span title="subprocess.Popen">Popen</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The process to read from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>msg</code></td>            <td>
                  <code><span title="execution.ipc.Message">Message</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message read, containing contents and signal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read from stdout and stderr.</span>

<span class="sd">    Args:</span>
<span class="sd">        proc (subprocess.Popen): The process to read from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        msg (Message): The message read, containing contents and signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">signal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">raw_signal</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">raw_contents</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">raw_signal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">raw_signal</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">raw_signal</span>
    <span class="k">if</span> <span class="n">raw_contents</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PipeCommunicator (Executor) - Set _use_pickle=False&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_unpickle_decode</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">raw_contents</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PipeCommunicator (Executor) - Set _use_pickle=True&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_unpickle_decode</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">signal</span> <span class="ow">and</span> <span class="n">signal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LUTE_SIGNALS</span><span class="p">:</span>
        <span class="c1"># Some tasks write on stderr</span>
        <span class="c1"># If the signal channel has &quot;non-signal&quot; info, add it to</span>
        <span class="c1"># contents</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">signal</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">signal</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.PipeCommunicator.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Write to stdout and stderr.</p>
<p>The signal component is sent to <code>stderr</code> while the contents of the
 Message are sent to <code>stdout</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>msg</code></td>
            <td>
                  <code><span title="execution.ipc.Message">Message</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Message to send.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write to stdout and stderr.</span>

<span class="sd">     The signal component is sent to `stderr` while the contents of the</span>
<span class="sd">     Message are sent to `stdout`.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (Message): The Message to send.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_pickle</span><span class="p">:</span>
        <span class="n">signal</span><span class="p">:</span> <span class="nb">bytes</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

        <span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_signal</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span><span class="p">:</span>
            <span class="n">raw_signal</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">signal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_signal</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">raw_contents</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">raw_contents</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">contents</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw_contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot send msg contents of type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span><span class="si">}</span><span class="s2"> when not using pickle!&quot;</span>
            <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw_signal</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw_contents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="execution.ipc.SocketCommunicator" class="doc doc-heading">
            <code>SocketCommunicator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="execution.ipc.Communicator" href="#execution.ipc.Communicator">Communicator</a></code></p>


      <p>Provides communication over Unix sockets.</p>


<details class="the-path-to-the-unix-socket-is-defined-by-the-environment-variable" open>
  <summary>The path to the Unix socket is defined by the environment variable</summary>
  <p><code>LUTE_SOCKET=/path/to/socket</code></p>
</details>      <p>This class assumes proper permissions and that this above environment
variable has been defined. The <code>Task</code> is configured as what would commonly
be referred to as the <code>client</code>, while the <code>Executor</code> is configured as the
server. The Executor continuosly monitors for connections and appends any
Messages that are received to a queue. Read requests retrieve Messages from
the queue. Task-side Communicators are fleeting so they open a connection,
send data, and immediately close and clean up.</p>

              <details class="quote">
                <summary>Source code in <code>lute/execution/ipc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SocketCommunicator</span><span class="p">(</span><span class="n">Communicator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides communication over Unix sockets.</span>

<span class="sd">    The path to the Unix socket is defined by the environment variable:</span>
<span class="sd">                      `LUTE_SOCKET=/path/to/socket`</span>
<span class="sd">    This class assumes proper permissions and that this above environment</span>
<span class="sd">    variable has been defined. The `Task` is configured as what would commonly</span>
<span class="sd">    be referred to as the `client`, while the `Executor` is configured as the</span>
<span class="sd">    server. The Executor continuosly monitors for connections and appends any</span>
<span class="sd">    Messages that are received to a queue. Read requests retrieve Messages from</span>
<span class="sd">    the queue. Task-side Communicators are fleeting so they open a connection,</span>
<span class="sd">    send data, and immediately close and clean up.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">READ_TIMEOUT</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maximum time to wait to retrieve data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IPC over a Unix socket.</span>

<span class="sd">        Unlike with the PipeCommunicator, pickle is always used to send data</span>
<span class="sd">        through the socket.</span>

<span class="sd">        Args:</span>
<span class="sd">            party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">                managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>

<span class="sd">            use_pickle (bool): Whether to use pickle. Always True currently,</span>
<span class="sd">                passing False does not change behaviour.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">party</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="n">use_pickle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Communicates through a Unix socket.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from a socket.</span>

<span class="sd">        Socket(s) are continuously monitored, and read from when new data is</span>
<span class="sd">        available.</span>

<span class="sd">        Args:</span>
<span class="sd">            proc (subprocess.Popen): The process to read from. Provided for</span>
<span class="sd">                compatibility with other Communicator subtypes. Is ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">             msg (Message): The message read, containing contents and signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">has_error</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">],</span>
            <span class="n">SocketCommunicator</span><span class="o">.</span><span class="n">READ_TIMEOUT</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span>
        <span class="k">if</span> <span class="n">has_data</span><span class="p">:</span>
            <span class="n">connection</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">has_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="n">full_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">full_data</span> <span class="o">+=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">full_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_data</span> <span class="k">else</span> <span class="n">Message</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a single Message.</span>

<span class="sd">        The entire Message (signal and contents) is serialized and sent through</span>
<span class="sd">        a connection over Unix socket.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (Message): The Message to send.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_socket</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a socket object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            data_socket (socket.socket): Unix socket object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">socket_path</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">socket_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LUTE_SOCKET&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">uuid</span>
            <span class="kn">import</span> <span class="nn">tempfile</span>

            <span class="c1"># Define a path,up and add to environment</span>
            <span class="c1"># Executor-side always created first, Task will use the same one</span>
            <span class="n">socket_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span><span class="si">}</span><span class="s2">/lute_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="si">}</span><span class="s2">.sock&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LUTE_SOCKET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket_path</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SocketCommunicator defines socket_path: </span><span class="si">{</span><span class="n">socket_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">data_socket</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_party</span> <span class="o">==</span> <span class="n">Party</span><span class="o">.</span><span class="n">EXECUTOR</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">socket_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">socket_path</span><span class="p">)</span>
            <span class="n">data_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">socket_path</span><span class="p">)</span>
            <span class="n">data_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_party</span> <span class="o">==</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">:</span>
            <span class="n">data_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">socket_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_socket</span>

    <span class="k">def</span> <span class="nf">_write_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sends data over a socket from the &#39;client&#39; (Task) side.</span>

<span class="sd">        Communicator objects on the Task-side are fleeting, so a socket is</span>
<span class="sd">        opened, data is sent, and then the connection and socket are cleaned up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_up</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_clean_up</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up connections.&quot;&quot;&quot;</span>
        <span class="c1"># Check the object exists in case the Communicator is cleaned up before</span>
        <span class="c1"># opening any connections</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_data_socket&quot;</span><span class="p">):</span>
            <span class="n">socket_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_party</span> <span class="o">==</span> <span class="n">Party</span><span class="o">.</span><span class="n">EXECUTOR</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">socket_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">socket_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">socket_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">socket_path</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_up</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="execution.ipc.SocketCommunicator.READ_TIMEOUT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">READ_TIMEOUT</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Maximum time to wait to retrieve data.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="execution.ipc.SocketCommunicator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>IPC over a Unix socket.</p>
<p>Unlike with the PipeCommunicator, pickle is always used to send data
through the socket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>party</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party" href="#execution.ipc.Party">Party</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which object (side/process) the Communicator is
managing IPC for. I.e., is this the "Task" or "Executor" side.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="execution.ipc.Party.TASK" href="#execution.ipc.Party.TASK">TASK</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_pickle</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use pickle. Always True currently,
passing False does not change behaviour.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">party</span><span class="p">:</span> <span class="n">Party</span> <span class="o">=</span> <span class="n">Party</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span> <span class="n">use_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;IPC over a Unix socket.</span>

<span class="sd">    Unlike with the PipeCommunicator, pickle is always used to send data</span>
<span class="sd">    through the socket.</span>

<span class="sd">    Args:</span>
<span class="sd">        party (Party): Which object (side/process) the Communicator is</span>
<span class="sd">            managing IPC for. I.e., is this the &quot;Task&quot; or &quot;Executor&quot; side.</span>

<span class="sd">        use_pickle (bool): Whether to use pickle. Always True currently,</span>
<span class="sd">            passing False does not change behaviour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">party</span><span class="o">=</span><span class="n">party</span><span class="p">,</span> <span class="n">use_pickle</span><span class="o">=</span><span class="n">use_pickle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Communicates through a Unix socket.&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_socket</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.SocketCommunicator.read" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Read data from a socket.</p>
<p>Socket(s) are continuously monitored, and read from when new data is
available.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>proc</code></td>
            <td>
                  <code><span title="subprocess.Popen">Popen</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The process to read from. Provided for
compatibility with other Communicator subtypes. Is ignored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>msg</code></td>            <td>
                  <code><span title="execution.ipc.Message">Message</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message read, containing contents and signal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read data from a socket.</span>

<span class="sd">    Socket(s) are continuously monitored, and read from when new data is</span>
<span class="sd">    available.</span>

<span class="sd">    Args:</span>
<span class="sd">        proc (subprocess.Popen): The process to read from. Provided for</span>
<span class="sd">            compatibility with other Communicator subtypes. Is ignored.</span>

<span class="sd">    Returns:</span>
<span class="sd">         msg (Message): The message read, containing contents and signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">has_data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">has_error</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">],</span>
        <span class="p">[],</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_socket</span><span class="p">],</span>
        <span class="n">SocketCommunicator</span><span class="o">.</span><span class="n">READ_TIMEOUT</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span>
    <span class="k">if</span> <span class="n">has_data</span><span class="p">:</span>
        <span class="n">connection</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">has_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="n">full_data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">full_data</span> <span class="o">+=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">full_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_data</span> <span class="k">else</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">msg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="execution.ipc.SocketCommunicator.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Send a single Message.</p>
<p>The entire Message (signal and contents) is serialized and sent through
a connection over Unix socket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>msg</code></td>
            <td>
                  <code><span title="execution.ipc.Message">Message</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Message to send.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/execution/ipc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a single Message.</span>

<span class="sd">    The entire Message (signal and contents) is serialized and sent through</span>
<span class="sd">    a connection over Unix socket.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (Message): The Message to send.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_socket</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
       2024 LCLS
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>