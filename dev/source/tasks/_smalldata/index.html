
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="GFD, VM">
      
      
      
        <link rel="prev" href="../smalldata/">
      
      
        <link rel="next" href="../math/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>_smalldata - LUTE</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tasks._smalldata" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LUTE" class="md-header__button md-logo" aria-label="LUTE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUTE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              _smalldata
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/slac-lcls/lute" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LUTE" class="md-nav__button md-logo" aria-label="LUTE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    LUTE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/slac-lcls/lute" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usage Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Usage Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../usage/running_lute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running LUTE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/new_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a new Task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/creating_workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a new Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Source Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Source Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../managed_tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    managed_tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    execution
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            execution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../execution/executor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    executor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../execution/ipc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ipc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../execution/debug_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    debug_utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../execution/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    tasks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasklets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tasklets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclasses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dataclasses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../_geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sfx_find_peaks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_find_peaks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sfx_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../smalldata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smalldata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    _smalldata
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    _smalldata
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tasks._smalldata" class="md-nav__link">
    <span class="md-ellipsis">
      _smalldata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyzeSmallData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyzeSmallData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._aggregate_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _aggregate_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_1d_water_norm" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_1d_water_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_avg_difference_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_avg_difference_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_binned_difference_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_binned_difference_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_set_pt" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_ccm_bins_by_set_pt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_unique" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_ccm_bins_by_unique
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_norm_by_max" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_norm_by_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_norm_by_qrange" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_norm_by_qrange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xss" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_bins" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_bins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_xss_dark_mean" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_xss_dark_mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._convolution_fit" class="md-nav__link">
    <span class="md-ellipsis">
      _convolution_fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int_pyfai" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int_pyfai
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int_smd_internal" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int_smd_internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_standard_data" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_standard_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._find_solvent_argmax" class="md-nav__link">
    <span class="md-ellipsis">
      _find_solvent_argmax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._fit_convolution_fwhm" class="md-nav__link">
    <span class="md-ellipsis">
      _fit_convolution_fwhm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._fit_overlap" class="md-nav__link">
    <span class="md-ellipsis">
      _fit_overlap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._setup_std_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _setup_std_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._update_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _update_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_all_xas" class="md-nav__link">
    <span class="md-ellipsis">
      plot_all_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_all_xss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_all_xss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_difference_xss_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_difference_xss_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_std_xas_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_std_xas_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_std_xes_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_std_xes_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_lxt_fast_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_lxt_fast_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_power_titration_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_power_titration_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_scan_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_scan_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_fast_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_lxt_fast_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_lxt_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_scan_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_scan_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xss_overlap_fit" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xss_overlap_fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    math
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mpi_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpi_test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_13" >
        
          
          <label class="md-nav__link" for="__nav_4_3_13" id="__nav_4_3_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    util
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_13">
            <span class="md-nav__icon md-icon"></span>
            util
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../util/html/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    html
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    io
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            io
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_4_1" id="__nav_4_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_1">
            <span class="md-nav__icon md-icon"></span>
            models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_find_peaks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_find_peaks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_merge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_merge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/sfx_solve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sfx_solve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/smd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/validators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/models/mpi_tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpi_tests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    db
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/_sqlite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _sqlite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/elog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    elog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../io/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exceptions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Design and Specifications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Design and Specifications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tasks._smalldata" class="md-nav__link">
    <span class="md-ellipsis">
      _smalldata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyzeSmallData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyzeSmallData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._aggregate_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _aggregate_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_1d_water_norm" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_1d_water_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_avg_difference_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_avg_difference_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_binned_difference_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_binned_difference_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_set_pt" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_ccm_bins_by_set_pt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_unique" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_ccm_bins_by_unique
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_norm_by_max" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_norm_by_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_norm_by_qrange" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_norm_by_qrange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xss" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_binned_difference_xss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_scan_bins" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_scan_bins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._calc_xss_dark_mean" class="md-nav__link">
    <span class="md-ellipsis">
      _calc_xss_dark_mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._convolution_fit" class="md-nav__link">
    <span class="md-ellipsis">
      _convolution_fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int_pyfai" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int_pyfai
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_az_int_smd_internal" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_az_int_smd_internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_standard_data" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_standard_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_xas" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._extract_xes" class="md-nav__link">
    <span class="md-ellipsis">
      _extract_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._find_solvent_argmax" class="md-nav__link">
    <span class="md-ellipsis">
      _find_solvent_argmax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._fit_convolution_fwhm" class="md-nav__link">
    <span class="md-ellipsis">
      _fit_convolution_fwhm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._fit_overlap" class="md-nav__link">
    <span class="md-ellipsis">
      _fit_overlap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._setup_std_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _setup_std_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData._update_filters" class="md-nav__link">
    <span class="md-ellipsis">
      _update_filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_all_xas" class="md-nav__link">
    <span class="md-ellipsis">
      plot_all_xas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_all_xss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_all_xss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_difference_xss_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_difference_xss_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_std_xas_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_std_xas_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_std_xes_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_std_xes_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_lxt_fast_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_lxt_fast_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_power_titration_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_power_titration_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xas_scan_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xas_scan_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_fast_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_lxt_fast_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_scan" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_lxt_scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xes_scan_hv" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xes_scan_hv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks._smalldata.AnalyzeSmallData.plot_xss_overlap_fit" class="md-nav__link">
    <span class="md-ellipsis">
      plot_xss_overlap_fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>_smalldata</h1>

<div class="doc doc-object doc-module">



<a id="tasks._smalldata"></a>
    <div class="doc doc-contents first">

        <p>Base classes for working with SmallData HDF5 files.</p>
<p>Classes defined in this module provide an interface to extracting data from
SmallData files and analyzing it. They are subclassed in the main <code>smalldata</code>
module for implementation into runnable Tasks.</p>


<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tasks._smalldata.AnalyzeSmallData" href="#tasks._smalldata.AnalyzeSmallData">AnalyzeSmallData</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Analyze a smalldata file, with MPI support.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tasks._smalldata.AnalyzeSmallData" class="doc doc-heading">
            <code>AnalyzeSmallData</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="tasks.task.Task" href="../task/#tasks.task.Task">Task</a></code></p>


        <p>Base class for analyzing a SmallData HDF5 file with MPI support.</p>






              <details class="quote">
                <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AnalyzeSmallData</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for analyzing a SmallData HDF5 file with MPI support.&quot;&quot;&quot;</span>

    <span class="n">_LARGE_DETNAMES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;epix10k2M&quot;</span><span class="p">,</span> <span class="s2">&quot;Rayonix&quot;</span><span class="p">,</span> <span class="s2">&quot;Jungfrau4M&quot;</span><span class="p">]</span>
    <span class="n">_SMALL_DETNAMES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;epix_1&quot;</span><span class="p">,</span> <span class="s2">&quot;epix_2&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">TaskParameters</span><span class="p">,</span> <span class="n">use_mpi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">use_mpi</span><span class="o">=</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="n">hv</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">&quot;bokeh&quot;</span><span class="p">)</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="p">:</span> <span class="n">MPI</span><span class="o">.</span><span class="n">Intracomm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">:</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">smd_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">smd_path</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_num_events</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;event_time&quot;</span><span class="p">][()])</span>
            <span class="n">quotient</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">remainder</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_total_num_events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">quotient</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">rank</span> <span class="o">&lt;</span> <span class="n">remainder</span> <span class="k">else</span> <span class="n">quotient</span>
                    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Bcast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Bcast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xss_detname</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">xss_detname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">AnalyzeSmallData</span><span class="o">.</span><span class="n">_LARGE_DETNAMES</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_xss_detname</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assuming XSS detector is: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No XSS detname provided and could not determine detname!&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xss_detname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">xss_detname</span>

        <span class="c1"># Basic RANK-LOCAL variables - Each rank holds a subset of data</span>
        <span class="c1">################################################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Rank </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span><span class="si">}</span><span class="s2">: Processing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="si">}</span><span class="s2"> events from &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;event </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Generic filtering variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrated_intensity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>

        <span class="c1"># Scan vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pre_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">_post_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">_extract_standard_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup up stored attributes by taking data from the smalldata hdf5 file.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ipm_var</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ipm data not found! Check config!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrated_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_std_filters</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">scan_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;scan/</span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="n">scan_var</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan variable </span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2"> not found!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">scan_var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;scan/</span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="n">scan_var</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan variable </span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2"> not found!&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_scan_values&quot;</span><span class="p">):</span>
            <span class="c1"># Create a set of scan values if none of the above scan</span>
            <span class="c1"># variables are found, either lxt_fast or linear set.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;enc/lasDelay&quot;</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="s2">&quot;lxt_fast&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using scan variable lxt_fast&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scan variable lxt_fast not found!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;No scans found, using linearly spaced data for _scan_values.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_az_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to extract the azimuthal integration data from HDF5 file.</span>

<span class="sd">        This internal method will search first to see if a detector has been</span>
<span class="sd">        provided as the scattering detector. If not, it will attempt to guess</span>
<span class="sd">        which detector to use. It will attempt to extract both the internal</span>
<span class="sd">        integration data and PyFAI integrated data (which have different</span>
<span class="sd">        interfaces). If both are present, it will only extract the internal</span>
<span class="sd">        algorithm data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xss_detname</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int_smd_internal</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extracted internal azimuthal integration data for </span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int_pyfai</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Extracted PyFAI azimuthal integration data for </span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No azimuthal integration data found.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_az_int_smd_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract stored data from SmallData&#39;s azimuthal integration algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">            detname (str): The detector name to extract data for.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav_azav&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>  <span class="c1"># 3D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;UserDataCfg/</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav__azav_q&quot;</span><span class="p">][()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phi_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;UserDataCfg/</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav__azav_phiVec&quot;</span><span class="p">][()]</span>

    <span class="k">def</span> <span class="nf">_extract_az_int_pyfai</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract stored data from PyFAI&#39;s azimuthal integration algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">            detname (str): The detector name to extract data for.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_azav&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>  <span class="c1"># 3D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_q&quot;</span><span class="p">][()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phi_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_az&quot;</span><span class="p">][()][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setup_std_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup the individual standard event filters.</span>

<span class="sd">        Sets up light status (X-ray and laser) filters, and adjustable filters</span>
<span class="sd">        based on, e.g., thresholds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For filtering based on event type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/xray&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;laser on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/laser&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/xray&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;laser off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/laser&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># Create scattering and ipm thresholds for first time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_filters</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update stored event filters that are based on adjustable parameters.</span>

<span class="sd">        E.g. update the minimum scattering intensity to use in analyses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scattering_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">min_Iscat</span>
        <span class="n">ipm_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">min_ipm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;total scattering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_integrated_intensity</span> <span class="o">&gt;</span> <span class="n">scattering_thresh</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_xray_intensity&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;ipm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span> <span class="o">&gt;</span> <span class="n">ipm_thresh</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;ipm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_norm_by_qrange</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">q_limits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a normalization factor by averaging over a range of Q values.</span>

<span class="sd">        Args:</span>
<span class="sd">            q_limits (Tuple[float, float]): The lower and upper limit of the</span>
<span class="sd">                Q-range to average.</span>

<span class="sd">        Returns:</span>
<span class="sd">            norm (np.ndarray[np.float64]): The 2D norm with shape</span>
<span class="sd">                (num_events, num_phi)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">norm_range</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">&gt;</span> <span class="n">q_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">norm_range</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">&lt;</span> <span class="n">q_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">norm_range</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_norm_by_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a normalization factor by taking the maximum of each profile.</span>

<span class="sd">        Returns:</span>
<span class="sd">        norm (np.ndarray[np.float64]): The 1D norm with shape (num_events)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_calc_1d_water_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate normalization factors by integrating the water ring.</span>

<span class="sd">        https://www.osti.gov/servlets/purl/1760438 says to use 1.5-3.5 A-1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># _ = self.find_solvent_argmax(self.scattering_laser_on_mean)</span>
        <span class="c1"># min_q_idx: int = self._solvent_peak_idx - 10</span>
        <span class="c1"># max_q_idx: int = self._solvent_peak_idx + 1</span>
        <span class="c1"># return np.nanmean(</span>
        <span class="c1">#    self.calc_norm_by_qrange((self.q_vals[min_q_idx], self.q_vals[max_q_idx])),</span>
        <span class="c1">#    axis=-1,</span>
        <span class="c1"># )</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_norm_by_qrange</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_aggregate_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filter_vars</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;xray on, laser on, total scattering, ipm&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine a number of possible data filters.</span>

<span class="sd">        Takes a string of filters to be applied in the order specified. The</span>
<span class="sd">        order matters for some filters, e.g. if &quot;percentage&quot; is selected it</span>
<span class="sd">        should be applied after total scattering. See below for a list of</span>
<span class="sd">        filters.</span>

<span class="sd">        Possible filters:</span>
<span class="sd">            &quot;xray on&quot;: Take shots where X-rays are on,</span>
<span class="sd">            &quot;xray off&quot;: Take shots where X-rays are off,</span>
<span class="sd">            &quot;laser on&quot;: Take shots where laser is on,</span>
<span class="sd">            &quot;laser off&quot;: Take shots where laser is off,</span>
<span class="sd">            &quot;ipm&quot;: Take shots with X-ray intensity above a value (ipm value),</span>
<span class="sd">            &quot;total scattering&quot;: Take shots with minimum integrated scattering,</span>
<span class="sd">            &quot;percentage&quot;: Extract this percentage of data centered on the max</span>
<span class="sd">                scattering intensity. Should be applied after total scatteirng.</span>
<span class="sd">                E.g. Include 50% of shots centered around the Q-value with</span>
<span class="sd">                maximum scattering.</span>

<span class="sd">        Args:</span>
<span class="sd">            filter_vars (str): A string of comma-seperated filters to apply,</span>
<span class="sd">                taken from the list above. E.g. &quot;xray on, laser on&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            total_filter (np.ndarray[np.bool]): A 1D boolean array with a shape</span>
<span class="sd">                of (num_events) which can be used to index and filter a data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filter_vars</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        <span class="n">total_filter</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">data_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total_filter</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="n">data_filter</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unrecognized filter requested: </span><span class="si">{</span><span class="n">data_filter</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;Ignoring and continuing processing.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">total_filter</span>

    <span class="k">def</span> <span class="nf">_calc_xss_dark_mean</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">profiles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the dark (X-ray off) mean of a set of XSS profiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            profiles (np.ndarray[np.float64]): Set of profiles to calculate the</span>
<span class="sd">                dark mean from. Shape: (n_events, q_bins)</span>
<span class="sd">        Returns:</span>
<span class="sd">            dark_mean (np.ndarray[np.float64]): The calculated dark mean.</span>
<span class="sd">                Shape: (q_bins)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dark_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dark_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">profiles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray off&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dark_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">dark_mean</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
            <span class="n">dark_mean</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No X-ray off event information for filtering. &quot;</span>
                <span class="s2">&quot;Dark mean will be all zeros.&quot;</span>
            <span class="p">)</span>
            <span class="n">dark_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dark_mean</span>

    <span class="k">def</span> <span class="nf">_find_solvent_argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corrected_profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the index of the solvent ring maximum.</span>

<span class="sd">        Currently just a hack around SciPy find_peaks.</span>

<span class="sd">        Args:</span>
<span class="sd">            corrected_profile (np.ndarray[np.float64]): 1D normalized and dark</span>
<span class="sd">                mean corrected, laser on, scattering profile.</span>

<span class="sd">        Returns:</span>
<span class="sd">            peak_idx (int): The index where the solvent maximum is located.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">find_peaks</span><span class="p">(</span><span class="n">corrected_profile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">peak_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">peak_heights</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No peaks found&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">corrected_profile</span><span class="p">)</span>

        <span class="n">peak_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">peak_indices</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peak_heights</span><span class="p">)</span>
        <span class="p">]</span>  <span class="c1"># peak_indices[0]  # peak_indices[peak_select - 1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solvent_peak_idx</span> <span class="o">=</span> <span class="n">peak_idx</span>
        <span class="k">return</span> <span class="n">peak_idx</span>

    <span class="k">def</span> <span class="nf">_fit_overlap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">guess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit overlap based on scattering difference signal to a Gaussian.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                scattering profile.</span>

<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">                (q_bins, scan_bins).</span>

<span class="sd">            guess (Optional[List[float]]): A list of initial parameter guesses</span>
<span class="sd">                for Gaussian fit in the order (amplitude, x0, sigma, background</span>
<span class="sd">                offset)</span>

<span class="sd">        Returns:</span>
<span class="sd">            raw_curve (np.ndarray[np.float64]): 1D difference slice at a specific</span>
<span class="sd">                Q value used for calculating the overlap.</span>

<span class="sd">            opt (np.ndarray[np.float64]): Optimized parameters.</span>

<span class="sd">            res (np.ndarray[np.float64]): Covariances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
        <span class="n">max_pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_solvent_argmax</span><span class="p">(</span><span class="n">laser_on</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx_peak_q</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">max_pt</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">: No non-nan values found.&quot;</span><span class="p">)</span>
            <span class="n">idx_peak_q</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>

        <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">diff</span><span class="p">[</span><span class="n">idx_peak_q</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">guess</span><span class="p">:</span>
            <span class="n">max_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">raw_curve</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">min_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">raw_curve</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="c1"># guess = [amplitude, center, stddev, bkgnd]</span>
            <span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span>
            <span class="k">if</span> <span class="n">max_val</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">raw_curve</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
                <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">raw_curve</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">opt</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">gaussian</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">999999</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2"> No non-nan values...&quot;</span><span class="p">)</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">guess</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">_fit_convolution_fwhm</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the FWHM of a convolution signal.</span>

<span class="sd">        Args:</span>
<span class="sd">            trace (np.ndarray[np.float64]): 1D convolution trace.</span>

<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fwhm (float): Calculated FWHM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">))</span>
        <span class="n">spline</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">trace</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="n">spline</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lb</span><span class="p">,</span> <span class="n">rb</span> <span class="o">=</span> <span class="n">roots</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="n">rb</span> <span class="o">-</span> <span class="n">lb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">min_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">guess</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">x0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">max_val</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
                <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
                <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
            <span class="n">opt</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                <span class="n">gaussian</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">999999</span>
            <span class="p">)</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="n">sigma_to_fwhm</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">fwhm</span>

    <span class="k">def</span> <span class="nf">_convolution_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits a time scan through convolution with Heaviside kernel.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                scattering profile.</span>

<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">                (q_bins, scan_bins).</span>

<span class="sd">        Returns:</span>
<span class="sd">            raw_curve (np.ndarray[np.float64]): 1D difference slice at a specific</span>
<span class="sd">                Q value used for calculating the overlap.</span>

<span class="sd">            trace (np.ndarray[np.float64]): 1D convolution trace.</span>

<span class="sd">            center (int): The index of the center from the convolution.</span>

<span class="sd">            fwhm (float): Width of the convlution signal (fwhm).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">fftconvolve</span>

        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_solvent_argmax</span><span class="p">(</span><span class="n">laser_on</span><span class="p">)</span>
        <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">max_pt</span> <span class="o">+</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">npts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">)</span>
        <span class="n">kernel</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">npts</span><span class="p">])</span>
        <span class="n">kernel</span><span class="p">[:</span> <span class="n">npts</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>
        <span class="n">center</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="n">fwhm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_convolution_fwhm</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">fwhm</span>

    <span class="c1"># XAS - Extraction and TR difference</span>
    <span class="c1">############################################################################</span>
    <span class="k">def</span> <span class="nf">_extract_xas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract XAS specific data.</span>

<span class="sd">        Extracts the integrated sum of an ROI as well as an CCM position data.</span>
<span class="sd">        Will search for both the readback value PV and, if present, the setpoint</span>
<span class="sd">        PV.</span>

<span class="sd">        Args:</span>
<span class="sd">            detname (str): The detector name to extract data for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_sum&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm_set</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                <span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No ccm_E_setpoint data. Will use fallback binning.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_element</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">element</span>

    <span class="k">def</span> <span class="nf">_calc_binned_difference_xas</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference absorption.</span>

<span class="sd">        Calculates the 1D difference absorption for a set of CCM bins.</span>
<span class="sd">        Final difference shape is 1D: (ccm_bins). Also returns bins and</span>
<span class="sd">        the laser on/off profiles.</span>

<span class="sd">        Returns None for all values if the final number of CCM bins is small (&lt;=2).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bins (Optional[np.ndarray[np.float64]]): 1D array of ccm bins used.</span>

<span class="sd">            diff (Optional[np.ndarray[np.float64]]): 1D binned difference absorption</span>
<span class="sd">                of shape (ccm_bins)</span>

<span class="sd">            laser_on (Optional[np.ndarray[np.float64]]): 1D laser on absorption</span>
<span class="sd">                profiles of shape (ccm_bins)</span>

<span class="sd">            laser_off (Optional[np.ndarray[np.float64]]): 1D laser off absorption</span>
<span class="sd">                profiles of shape (ccm_bins)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">b_edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># nbins = len(self.ccm_E_set_pt)</span>
            <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_ccm_bins_by_set_pt</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_ccm_bins_by_unique</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">nbins</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
        <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
            <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
        <span class="p">)</span>
        <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_1d_water_norm</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
        <span class="n">xas_norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">/</span> <span class="n">norm</span>

        <span class="n">xas_laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
        <span class="n">xas_laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
        <span class="c1"># bins are [lower, upper) except for last which is [lower, upper]</span>
        <span class="c1"># _, b_edges = np.histogram(self.ccm_E_unique, bins=nbins)</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nbins</span><span class="p">])</span>
        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>  <span class="c1"># - win_size + 1</span>
            <span class="n">win</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">):</span>
            <span class="n">lower</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">upper</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Prepare CCM_E bin</span>
            <span class="n">energy_filt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># upper edge inclusive bin</span>
                <span class="n">energy_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&lt;=</span> <span class="n">upper</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">energy_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&lt;</span> <span class="n">upper</span>
            <span class="n">energy_filt</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&gt;=</span> <span class="n">lower</span>
            <span class="n">full_filt_on</span> <span class="o">=</span> <span class="n">filter_las_on</span> <span class="o">&amp;</span> <span class="n">energy_filt</span>
            <span class="n">full_filt_off</span> <span class="o">=</span> <span class="n">filter_las_off</span> <span class="o">&amp;</span> <span class="n">energy_filt</span>
            <span class="n">xas_laser_on</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xas_norm</span><span class="p">[</span><span class="n">full_filt_on</span><span class="p">])</span>
            <span class="n">xas_laser_off</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xas_norm</span><span class="p">[</span><span class="n">full_filt_off</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">bins</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_on</span> <span class="o">-</span> <span class="n">xas_laser_off</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_on</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_off</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># XES - Extraction and TR difference</span>
    <span class="c1">############################################################################</span>
    <span class="k">def</span> <span class="nf">_extract_xes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract XAS specific data.</span>

<span class="sd">        Extracts individual ROIs and applys projections to extract the XES</span>
<span class="sd">        spectra. Depending on input TaskParameters, it will optionally rotate</span>
<span class="sd">        each ROI by some degrees prior to projection.</span>

<span class="sd">        By default, this method will read all ROIs into memory simultaneously</span>
<span class="sd">        and then project them. Alternatively, e.g. if encountering memory issues,</span>
<span class="sd">        input parameters can be changed to switch to reading in batches. Set the</span>
<span class="sd">        `batch_size` parameter to indicate the number of events to read into memory</span>
<span class="sd">        at once.</span>

<span class="sd">        Args:</span>
<span class="sd">            detname (str): The detector name to extract data for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Lets assume they set up the ROI nicley?</span>
        <span class="c1"># By xcsl1004821</span>
        <span class="c1"># proj0 should be spatial distribution</span>
        <span class="c1"># proj1 should be XES (unless invert == True)</span>
        <span class="n">spatial_axis</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">spectral_axis</span><span class="p">:</span> <span class="nb">int</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
            <span class="n">spatial_axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">spectral_axis</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spatial_axis</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">spectral_axis</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
            <span class="c1"># Read data in batches for OOM issues</span>
            <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">batch_size</span>

            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
                <span class="n">end</span><span class="p">:</span> <span class="nb">int</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span>
                <span class="n">xes_roi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_area&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">,</span> <span class="n">xes_roi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">rotate</span>

                    <span class="n">xes_roi</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                        <span class="n">xes_roi</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">spatial_dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">guess_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">spatial_dist</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                        <span class="n">xes_roi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                        <span class="n">xes_roi</span><span class="p">[:,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xes_roi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_area&quot;</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">rotate</span>

                <span class="n">xes_roi</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">spatial_dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="n">xes_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">guess_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">spatial_dist</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">[:,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_avg_difference_xes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the average difference XES.</span>

<span class="sd">        Calculates the 1D difference emission spectra in pixels.</span>
<span class="sd">        Final difference shape is 1D: (pixels). Also returns the laser on/off</span>
<span class="sd">        profiles. The number of pixels is determined by the projection axis after</span>
<span class="sd">        image rotation if that is requested (see _extract_xes).</span>

<span class="sd">        Returns:</span>
<span class="sd">            diff (np.ndarray[np.float64]): 1D binned difference emission of shape</span>
<span class="sd">                (pixels)</span>

<span class="sd">            laser_on (np.ndarray[np.float64]): 1D laser on emission profiles</span>
<span class="sd">                of shape (pixels)</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D laser off emission profiles</span>
<span class="sd">                of shape (pixels)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
        <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
            <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
        <span class="p">)</span>

        <span class="n">xes_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">xes_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">xes_on</span> <span class="o">-</span> <span class="n">xes_off</span>

        <span class="k">return</span> <span class="n">diff</span><span class="p">,</span> <span class="n">xes_on</span><span class="p">,</span> <span class="n">xes_off</span>

    <span class="c1"># Binning</span>
    <span class="c1">############################################################################</span>
    <span class="k">def</span> <span class="nf">_calc_ccm_bins_by_set_pt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Caculate bin edges based on the provided CCM_E set points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bins (np.ndarray[np.float64]): 1D array of ccm bins used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_set_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="n">all_set_pts</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
                    <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_set_pts</span><span class="p">))</span>
            <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Set points not provided/not found!&quot;</span><span class="p">)</span>

        <span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># How to handle the ends?</span>
        <span class="c1"># Lower bin inclusive, upper not (except last)</span>
        <span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>
        <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">edges</span>

    <span class="k">def</span> <span class="nf">_calc_ccm_bins_by_unique</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate bin edges based on unique CCM_E recorded values.</span>

<span class="sd">        Args:</span>
<span class="sd">            nbins (int): Number of bins to create. 50-100 is empirically useful.</span>

<span class="sd">        Returns:</span>
<span class="sd">            nbins (int): Number of bins.</span>

<span class="sd">            b_edges (np.ndarray[np.float64]): Bin edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_ccm_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">all_ccm_values</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
                <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">unique</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_ccm_values</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">all_ccm_values</span>
        <span class="n">nbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">nbins</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)])</span>
        <span class="n">b_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span>

    <span class="k">def</span> <span class="nf">_calc_scan_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">51</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a set of scan bins.</span>

<span class="sd">        Args:</span>
<span class="sd">            nbins (int): Number of bins to create.</span>

<span class="sd">        Returns:</span>
<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of scan bins.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a full set of scan values</span>
        <span class="n">all_scan_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">all_scan_values</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
                <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">all_scan_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">)</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scan_bins</span>

    <span class="c1"># Differences by scan</span>
    <span class="c1">############################################################################</span>

    <span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference scattering.</span>

<span class="sd">        Calculates the 1D difference scattering for each bin of a scan variable.</span>
<span class="sd">        Final difference shape is 2D: (q_bins, scan_bins). Also returns bins and</span>
<span class="sd">        the laser on profiles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bins (np.ndarray[np.float64]): 1D array of scan bins used.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D binned difference scattering of shape</span>
<span class="sd">                (q_bins, scan_bins)</span>

<span class="sd">            laser_on (np.ndarray[np.float64]): 2D laser on scattering profiles</span>
<span class="sd">                of shape (n_events_las_on, q_bins)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">profiles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dark_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_xss_dark_mean</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dark_mean</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Can be len == 1 if all nan</span>
            <span class="n">profiles</span> <span class="o">-=</span> <span class="n">dark_mean</span>
        <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_norm_by_qrange</span><span class="p">()</span>
        <span class="n">profiles</span> <span class="o">=</span> <span class="p">(</span><span class="n">profiles</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">del</span> <span class="n">dark_mean</span>
        <span class="k">del</span> <span class="n">norm</span>

        <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
        <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
            <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
        <span class="p">)</span>
        <span class="n">normed_xss_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">normed_xss_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>
        <span class="n">binned_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)))</span>
        <span class="n">binned_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)))</span>
        <span class="n">scanvals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">scanvals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">scan_bin</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">scan_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scanvals_las_on</span> <span class="o">&gt;=</span> <span class="n">scan_bin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">scanvals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scanvals_las_off</span> <span class="o">&gt;=</span> <span class="n">scan_bin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">scanvals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">binned_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">normed_xss_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">binned_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">normed_xss_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                    <span class="n">normed_xss_las_on</span><span class="p">[(</span><span class="n">scanvals_las_on</span> <span class="o">==</span> <span class="n">scan_bin</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">binned_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                    <span class="n">normed_xss_las_off</span><span class="p">[(</span><span class="n">scanvals_las_off</span> <span class="o">==</span> <span class="n">scan_bin</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">binned_on</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
            <span class="n">binned_off</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">normed_xss_las_on</span>

    <span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xas</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference absorption.</span>

<span class="sd">        Calculates the difference absorption for each bin of a scan variable.</span>
<span class="sd">        Final difference shape is 1D: (scan_bins)</span>

<span class="sd">        Returns None for all values if the final number of bins is small (&lt;=2).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bins (Optional[np.ndarray[np.float64]]): 1D array of scan bins used.</span>

<span class="sd">            diff (Optional[np.ndarray[np.float64]]): 1D difference absorption.</span>

<span class="sd">            laser_off (Optional[np.ndarray[np.float64]]): 1D laser on absorption.</span>

<span class="sd">            laser_off (Optional[np.ndarray[np.float64]]): 1D laser off absorption.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
        <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
            <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
        <span class="p">)</span>
        <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
        <span class="n">normed_xas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">/</span> <span class="n">norm</span>
        <span class="n">normed_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xas</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">normed_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xas</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

        <span class="n">scan_vals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">scan_vals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

        <span class="n">lxt_fast_scan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
            <span class="n">binned_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">binned_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binned_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
            <span class="n">binned_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bin_or_bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_vals_las_on</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_vals_las_off</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">binned_xas_las_on</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xas_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">])</span>
                <span class="n">binned_xas_las_off</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xas_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned_xas_las_on</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">normed_xas_las_on</span><span class="p">[</span><span class="n">scan_vals_las_on</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">binned_xas_las_off</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">normed_xas_las_off</span><span class="p">[</span><span class="n">scan_vals_las_off</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned_xas_las_on</span> <span class="o">-</span> <span class="n">binned_xas_las_off</span>
        <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">binned_xas_las_on</span><span class="p">,</span> <span class="n">binned_xas_las_off</span>

    <span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference emission.</span>

<span class="sd">        Calculates the difference emission for each bin of a scan variable.</span>
<span class="sd">        Final difference shape is 2D: (pixels, scan_bins) where the pixel</span>
<span class="sd">        axis is energy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bins (np.ndarray[np.float64]): 1D array of scan bins used.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference emission.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 2D laser on emission.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 2D laser off emission.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
        <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
            <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
        <span class="p">)</span>
        <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
        <span class="n">normed_xes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">normed_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xes</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">normed_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xes</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

        <span class="n">scan_vals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
        <span class="n">scan_vals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>

        <span class="n">lxt_fast_scan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
            <span class="n">binned_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">normed_xes_las_on</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">binned_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">normed_xes_las_off</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binned_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">normed_xes_las_on</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">binned_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">normed_xes_las_off</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bin_or_bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_vals_las_on</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_vals_las_off</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">binned_xes_las_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xes_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">binned_xes_las_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">normed_xes_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned_xes_las_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">normed_xes_las_on</span><span class="p">[</span><span class="n">scan_vals_las_on</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">binned_xes_las_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">normed_xes_las_off</span><span class="p">[</span><span class="n">scan_vals_las_off</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>

        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">binned_xes_las_on</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
            <span class="n">binned_xes_las_off</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">binned_xes_las_on</span><span class="p">,</span> <span class="n">binned_xes_las_off</span>

    <span class="c1"># Plots</span>
    <span class="c1">############################################################################</span>

    <span class="c1"># XSS</span>
    <span class="k">def</span> <span class="nf">plot_avg_xss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">q_vals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">phis</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">plot_difference_xss_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">q_vals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the binned difference scattering.</span>

<span class="sd">        Args:</span>
<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            q_vals (np.ndarray[np.float64]): 1D set of Q bins.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">                (q_bins, scan_bins).</span>

<span class="sd">            scan_var_name (str): Name of the scan variable (for titles, etc.).</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.GridSpec): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference Profiles&quot;</span><span class="p">)</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;scan_var&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Scan Var </span><span class="si">{</span><span class="n">scan_var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">))</span>
        <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
            <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">contours</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Q&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dS&quot;</span><span class="p">,</span> <span class="s2">&quot;dS&quot;</span><span class="p">))</span>
        <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span>
        <span class="n">diff_curves</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">q_vals</span><span class="p">,</span>
                        <span class="n">diff</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grid</span>

    <span class="k">def</span> <span class="nf">plot_xss_overlap_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the overlap fit to a slice of the binned difference.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                scattering profile.</span>

<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">                (q_bins, scan_bins).</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (plt.Figure): Plotted overlap fit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
            <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
            <span class="n">center</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">fwhm</span><span class="p">:</span> <span class="nb">float</span>
            <span class="n">raw_curve</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">fwhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convolution_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Scan Var: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Overlap Position: </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">center</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;FWHM: </span><span class="si">{</span><span class="n">fwhm</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw&quot;</span><span class="p">)</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Convolution&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan Variable (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$S&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
            <span class="n">opt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
            <span class="n">raw_curve</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_overlap</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Scan Var: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Overlap Position: </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;FWHM: </span><span class="si">{</span><span class="n">sigma_to_fwhm</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">opt</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan Variable (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$S&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">plot_all_xss</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot all relevant scattering plots.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                scattering profile.</span>

<span class="sd">            bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">                (q_bins, scan_bins).</span>

<span class="sd">            scan_var_name (str): Name of the scan variable (for titles, etc.).</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): All plots in separated tabs in a pn.Tabs object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avg_fig = self.plot_avg_xss()</span>
        <span class="n">overlap_fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xss_overlap_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

        <span class="c1"># avg_grid = pn.GridSpec(name=&quot;TR X-ray Scattering&quot;)</span>
        <span class="c1"># avg_grid[:2, :2] = avg_fig</span>

        <span class="n">diff_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_difference_xss_hv</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">scan_var_name</span><span class="p">)</span>
        <span class="n">overlap_grid</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overlap Fit&quot;</span><span class="p">)</span>
        <span class="n">overlap_grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlap_fig</span>

        <span class="n">tabbed_display</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">diff_grid</span><span class="p">)</span>
        <span class="n">tabbed_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap_grid</span><span class="p">)</span>
        <span class="c1"># tabbed_display.append(avg_grid)</span>

        <span class="k">return</span> <span class="n">tabbed_display</span>

    <span class="c1"># XAS</span>
    <span class="k">def</span> <span class="nf">plot_all_xas</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">ccm_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot XAS and optionally EXAFS</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            ccm_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): All plots in separated tabs in a pn.Tabs object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std_xas_grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_std_xas_hv</span><span class="p">(</span>
            <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span>
        <span class="p">)</span>
        <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">std_xas_grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="p">,</span> <span class="s2">&quot;analyze_exafs&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">analyze_exafs</span>
        <span class="p">):</span>
            <span class="o">...</span>
            <span class="c1"># exafs_grid: pn.GridSpec = self.plot_exafs_hv()</span>
            <span class="c1"># tabs.append(exafs_grid)</span>

        <span class="k">return</span> <span class="n">tabs</span>

    <span class="k">def</span> <span class="nf">plot_std_xas_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">ccm_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot relevant XAS plots.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            ccm_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.GridSpec): Laser on/off and difference XAS plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;ccm_E&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">))</span>

        <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
        <span class="p">)</span>
        <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
        <span class="p">)</span>
        <span class="n">xas_plots</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

        <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;dA/dE&quot;</span><span class="p">))</span>

        <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span>
        <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span><span class="p">([</span><span class="n">diff_pts</span><span class="p">,</span> <span class="n">diff_curve</span><span class="p">])</span>

        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;XAS&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span>
        <span class="k">return</span> <span class="n">grid</span>

    <span class="k">def</span> <span class="nf">plot_xas_scan_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot scan binned XAS data.</span>

<span class="sd">        Currently handles lxe_opa power titration and t0 (lxt_fast) XAS scans.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Skipping scan plots - requested scan variables not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;lxe_opa&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xas_power_titration_scan</span><span class="p">(</span>
                <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xas_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_xas_lxt_fast_scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a plot of an lxt_fast scan for time zero (or real signal).</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt_fast&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt_fast&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Normalized A&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalized A&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scan_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">scan_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">xas_plots</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

        <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;diff A&quot;</span><span class="p">))</span>
        <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
            <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on - Laser off&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
        <span class="p">)</span>
        <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_pts</span> <span class="o">*</span> <span class="n">diff_curve</span>

        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lxt_fast T0 scan&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tabs</span>

    <span class="k">def</span> <span class="nf">plot_xas_power_titration_scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a plot of the lxe_opa power titration.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                absorption spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxe_opa&quot;</span><span class="p">,</span> <span class="s2">&quot;lxe_opa&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Normalized A&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalized A&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
        <span class="p">)</span>
        <span class="n">xas_plots</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

        <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;diff A&quot;</span><span class="p">))</span>
        <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
            <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on - Laser off&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
        <span class="p">)</span>
        <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_pts</span> <span class="o">*</span> <span class="n">diff_curve</span>

        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Titration&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tabs</span>

    <span class="c1"># XES</span>
    <span class="k">def</span> <span class="nf">plot_xes_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">energy_bins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot XES and difference XES. In the future will provide other plots.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            energy_bins (Optional[np.ndarray[np.float64]]): 1D set of bins used</span>
<span class="sd">                for the energy axis. If None, will just use pixels for that axis.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">std_xes_grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_std_xes_hv</span><span class="p">(</span>
            <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">diff</span>
        <span class="p">)</span>
        <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">std_xes_grid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tabs</span>

    <span class="k">def</span> <span class="nf">plot_std_xes_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">energy_bins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot XES and difference XES.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            energy_bins (Optional[np.ndarray[np.float64]]): 1D set of bins used</span>
<span class="sd">                for the energy axis. If None, will just use pixels for that axis.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">))</span>

        <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">energy_bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># May be float, above is int</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">energy_bins</span>

        <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
        <span class="p">)</span>
        <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
        <span class="p">)</span>
        <span class="n">xes_plots</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

        <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff I&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

        <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span>
        <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span><span class="p">([</span><span class="n">diff_pts</span><span class="p">,</span> <span class="n">diff_curve</span><span class="p">])</span>

        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;XES&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xes_plots</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span>
        <span class="k">return</span> <span class="n">grid</span>

    <span class="k">def</span> <span class="nf">plot_xes_scan_hv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot scan binned XES data.</span>

<span class="sd">        Currently handles lxt and lxt_fast XES scans.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (Optional[pn.Tabs]): Plotted binned difference. Returns None if</span>
<span class="sd">                the scan variable is unknown/unrecognized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping scan plots - requested scan variables not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xes_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;lxt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xes_lxt_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_xes_lxt_fast_scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot lxt_fast scan binned XES data.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference XES&quot;</span><span class="p">)</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt_fast&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt_fast&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scan_bins</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">scan_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">bin_centers</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
                <span class="n">diff</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">contours</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Contours</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shared</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">contours</span>
        <span class="n">shared</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared</span>

        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dI&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

        <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span>
                <span class="p">)</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_xes_lxt_scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot lxt scan binned XES data.</span>

<span class="sd">        Args:</span>
<span class="sd">            laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">                emission spectrum.</span>

<span class="sd">            scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">                signal.</span>

<span class="sd">            diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">        Returns:</span>
<span class="sd">            plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference XES&quot;</span><span class="p">)</span>
        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt&quot;</span><span class="p">))</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">scan_bins</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
                <span class="n">diff</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">contours</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Contours</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shared</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">contours</span>
        <span class="n">shared</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared</span>

        <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dI&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

        <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scan_bins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span>
                <span class="p">)</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._aggregate_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_aggregate_filters</span><span class="p">(</span><span class="n">filter_vars</span><span class="o">=</span><span class="s1">&#39;xray on, laser on, total scattering, ipm&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Combine a number of possible data filters.</p>
<p>Takes a string of filters to be applied in the order specified. The
order matters for some filters, e.g. if "percentage" is selected it
should be applied after total scattering. See below for a list of
filters.</p>


<details class="possible-filters" open>
  <summary>Possible filters</summary>
  <p>"xray on": Take shots where X-rays are on,
"xray off": Take shots where X-rays are off,
"laser on": Take shots where laser is on,
"laser off": Take shots where laser is off,
"ipm": Take shots with X-ray intensity above a value (ipm value),
"total scattering": Take shots with minimum integrated scattering,
"percentage": Extract this percentage of data centered on the max
    scattering intensity. Should be applied after total scatteirng.
    E.g. Include 50% of shots centered around the Q-value with
    maximum scattering.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filter_vars</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string of comma-seperated filters to apply,
taken from the list above. E.g. "xray on, laser on".</p>
              </div>
            </td>
            <td>
                  <code>&#39;xray on, laser on, total scattering, ipm&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>total_filter</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1D boolean array with a shape
of (num_events) which can be used to index and filter a data array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_aggregate_filters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filter_vars</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;xray on, laser on, total scattering, ipm&quot;</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine a number of possible data filters.</span>

<span class="sd">    Takes a string of filters to be applied in the order specified. The</span>
<span class="sd">    order matters for some filters, e.g. if &quot;percentage&quot; is selected it</span>
<span class="sd">    should be applied after total scattering. See below for a list of</span>
<span class="sd">    filters.</span>

<span class="sd">    Possible filters:</span>
<span class="sd">        &quot;xray on&quot;: Take shots where X-rays are on,</span>
<span class="sd">        &quot;xray off&quot;: Take shots where X-rays are off,</span>
<span class="sd">        &quot;laser on&quot;: Take shots where laser is on,</span>
<span class="sd">        &quot;laser off&quot;: Take shots where laser is off,</span>
<span class="sd">        &quot;ipm&quot;: Take shots with X-ray intensity above a value (ipm value),</span>
<span class="sd">        &quot;total scattering&quot;: Take shots with minimum integrated scattering,</span>
<span class="sd">        &quot;percentage&quot;: Extract this percentage of data centered on the max</span>
<span class="sd">            scattering intensity. Should be applied after total scatteirng.</span>
<span class="sd">            E.g. Include 50% of shots centered around the Q-value with</span>
<span class="sd">            maximum scattering.</span>

<span class="sd">    Args:</span>
<span class="sd">        filter_vars (str): A string of comma-seperated filters to apply,</span>
<span class="sd">            taken from the list above. E.g. &quot;xray on, laser on&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        total_filter (np.ndarray[np.bool]): A 1D boolean array with a shape</span>
<span class="sd">            of (num_events) which can be used to index and filter a data array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filter_vars</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
    <span class="n">total_filter</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">data_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">total_filter</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="n">data_filter</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unrecognized filter requested: </span><span class="si">{</span><span class="n">data_filter</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Ignoring and continuing processing.&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">total_filter</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_1d_water_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_1d_water_norm</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate normalization factors by integrating the water ring.</p>
<p>https://www.osti.gov/servlets/purl/1760438 says to use 1.5-3.5 A-1</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_1d_water_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate normalization factors by integrating the water ring.</span>

<span class="sd">    https://www.osti.gov/servlets/purl/1760438 says to use 1.5-3.5 A-1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># _ = self.find_solvent_argmax(self.scattering_laser_on_mean)</span>
    <span class="c1"># min_q_idx: int = self._solvent_peak_idx - 10</span>
    <span class="c1"># max_q_idx: int = self._solvent_peak_idx + 1</span>
    <span class="c1"># return np.nanmean(</span>
    <span class="c1">#    self.calc_norm_by_qrange((self.q_vals[min_q_idx], self.q_vals[max_q_idx])),</span>
    <span class="c1">#    axis=-1,</span>
    <span class="c1"># )</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_norm_by_qrange</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_avg_difference_xes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_avg_difference_xes</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the average difference XES.</p>
<p>Calculates the 1D difference emission spectra in pixels.
Final difference shape is 1D: (pixels). Also returns the laser on/off
profiles. The number of pixels is determined by the projection axis after
image rotation if that is requested (see _extract_xes).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>diff</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D binned difference emission of shape
(pixels)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_on</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser on emission profiles
of shape (pixels)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser off emission profiles
of shape (pixels)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_avg_difference_xes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the average difference XES.</span>

<span class="sd">    Calculates the 1D difference emission spectra in pixels.</span>
<span class="sd">    Final difference shape is 1D: (pixels). Also returns the laser on/off</span>
<span class="sd">    profiles. The number of pixels is determined by the projection axis after</span>
<span class="sd">    image rotation if that is requested (see _extract_xes).</span>

<span class="sd">    Returns:</span>
<span class="sd">        diff (np.ndarray[np.float64]): 1D binned difference emission of shape</span>
<span class="sd">            (pixels)</span>

<span class="sd">        laser_on (np.ndarray[np.float64]): 1D laser on emission profiles</span>
<span class="sd">            of shape (pixels)</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D laser off emission profiles</span>
<span class="sd">            of shape (pixels)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
    <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
        <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
    <span class="p">)</span>

    <span class="n">xes_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">xes_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">xes_on</span> <span class="o">-</span> <span class="n">xes_off</span>

    <span class="k">return</span> <span class="n">diff</span><span class="p">,</span> <span class="n">xes_on</span><span class="p">,</span> <span class="n">xes_off</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_binned_difference_xas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_binned_difference_xas</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the binned difference absorption.</p>
<p>Calculates the 1D difference absorption for a set of CCM bins.
Final difference shape is 1D: (ccm_bins). Also returns bins and
the laser on/off profiles.</p>
<p>Returns None for all values if the final number of CCM bins is small (&lt;=2).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bins</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of ccm bins used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>diff</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D binned difference absorption
of shape (ccm_bins)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_on</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser on absorption
profiles of shape (ccm_bins)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser off absorption
profiles of shape (ccm_bins)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_binned_difference_xas</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference absorption.</span>

<span class="sd">    Calculates the 1D difference absorption for a set of CCM bins.</span>
<span class="sd">    Final difference shape is 1D: (ccm_bins). Also returns bins and</span>
<span class="sd">    the laser on/off profiles.</span>

<span class="sd">    Returns None for all values if the final number of CCM bins is small (&lt;=2).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bins (Optional[np.ndarray[np.float64]]): 1D array of ccm bins used.</span>

<span class="sd">        diff (Optional[np.ndarray[np.float64]]): 1D binned difference absorption</span>
<span class="sd">            of shape (ccm_bins)</span>

<span class="sd">        laser_on (Optional[np.ndarray[np.float64]]): 1D laser on absorption</span>
<span class="sd">            profiles of shape (ccm_bins)</span>

<span class="sd">        laser_off (Optional[np.ndarray[np.float64]]): 1D laser off absorption</span>
<span class="sd">            profiles of shape (ccm_bins)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b_edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># nbins = len(self.ccm_E_set_pt)</span>
        <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_ccm_bins_by_set_pt</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_ccm_bins_by_unique</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">nbins</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
    <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
        <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
    <span class="p">)</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_1d_water_norm</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
    <span class="n">xas_norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">/</span> <span class="n">norm</span>

    <span class="n">xas_laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">xas_laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="c1"># bins are [lower, upper) except for last which is [lower, upper]</span>
    <span class="c1"># _, b_edges = np.histogram(self.ccm_E_unique, bins=nbins)</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nbins</span><span class="p">])</span>
    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>  <span class="c1"># - win_size + 1</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">):</span>
        <span class="n">lower</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">upper</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">b_edges</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Prepare CCM_E bin</span>
        <span class="n">energy_filt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># upper edge inclusive bin</span>
            <span class="n">energy_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&lt;=</span> <span class="n">upper</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energy_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&lt;</span> <span class="n">upper</span>
        <span class="n">energy_filt</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">&gt;=</span> <span class="n">lower</span>
        <span class="n">full_filt_on</span> <span class="o">=</span> <span class="n">filter_las_on</span> <span class="o">&amp;</span> <span class="n">energy_filt</span>
        <span class="n">full_filt_off</span> <span class="o">=</span> <span class="n">filter_las_off</span> <span class="o">&amp;</span> <span class="n">energy_filt</span>
        <span class="n">xas_laser_on</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xas_norm</span><span class="p">[</span><span class="n">full_filt_on</span><span class="p">])</span>
        <span class="n">xas_laser_off</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xas_norm</span><span class="p">[</span><span class="n">full_filt_off</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">bins</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_on</span> <span class="o">-</span> <span class="n">xas_laser_off</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_on</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">xas_laser_off</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_set_pt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_ccm_bins_by_set_pt</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Caculate bin edges based on the provided CCM_E set points.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bins</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of ccm bins used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_ccm_bins_by_set_pt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caculate bin edges based on the provided CCM_E set points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bins (np.ndarray[np.float64]): 1D array of ccm bins used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_set_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">all_set_pts</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
                <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_set_pts</span><span class="p">))</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Set points not provided/not found!&quot;</span><span class="p">)</span>

    <span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_centers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_centers</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># How to handle the ends?</span>
    <span class="c1"># Lower bin inclusive, upper not (except last)</span>
    <span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_ccm_bins_by_unique" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_ccm_bins_by_unique</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate bin edges based on unique CCM_E recorded values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nbins</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins to create. 50-100 is empirically useful.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>nbins</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>b_edges</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin edges.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_ccm_bins_by_unique</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate bin edges based on unique CCM_E recorded values.</span>

<span class="sd">    Args:</span>
<span class="sd">        nbins (int): Number of bins to create. 50-100 is empirically useful.</span>

<span class="sd">    Returns:</span>
<span class="sd">        nbins (int): Number of bins.</span>

<span class="sd">        b_edges (np.ndarray[np.float64]): Bin edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_ccm_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">all_ccm_values</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
            <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">unique</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_ccm_values</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">all_ccm_values</span>
    <span class="n">nbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">nbins</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)])</span>
    <span class="n">b_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">b_edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_norm_by_max" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_norm_by_max</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate a normalization factor by taking the maximum of each profile.</p>
<p>Returns:
norm (np.ndarray[np.float64]): The 1D norm with shape (num_events)</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_norm_by_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate a normalization factor by taking the maximum of each profile.</span>

<span class="sd">    Returns:</span>
<span class="sd">    norm (np.ndarray[np.float64]): The 1D norm with shape (num_events)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_norm_by_qrange" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_norm_by_qrange</span><span class="p">(</span><span class="n">q_limits</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate a normalization factor by averaging over a range of Q values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q_limits</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lower and upper limit of the
Q-range to average.</p>
              </div>
            </td>
            <td>
                  <code>(0.9, 3.5)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>norm</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 2D norm with shape
(num_events, num_phi)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_norm_by_qrange</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">q_limits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate a normalization factor by averaging over a range of Q values.</span>

<span class="sd">    Args:</span>
<span class="sd">        q_limits (Tuple[float, float]): The lower and upper limit of the</span>
<span class="sd">            Q-range to average.</span>

<span class="sd">    Returns:</span>
<span class="sd">        norm (np.ndarray[np.float64]): The 2D norm with shape</span>
<span class="sd">            (num_events, num_phi)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm_range</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">&gt;</span> <span class="n">q_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">norm_range</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">&lt;</span> <span class="n">q_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">norm_range</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_scan_binned_difference_xas</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the binned difference absorption.</p>
<p>Calculates the difference absorption for each bin of a scan variable.
Final difference shape is 1D: (scan_bins)</p>
<p>Returns None for all values if the final number of bins is small (&lt;=2).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bins</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of scan bins used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>diff</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser on absorption.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D laser off absorption.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xas</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference absorption.</span>

<span class="sd">    Calculates the difference absorption for each bin of a scan variable.</span>
<span class="sd">    Final difference shape is 1D: (scan_bins)</span>

<span class="sd">    Returns None for all values if the final number of bins is small (&lt;=2).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bins (Optional[np.ndarray[np.float64]]): 1D array of scan bins used.</span>

<span class="sd">        diff (Optional[np.ndarray[np.float64]]): 1D difference absorption.</span>

<span class="sd">        laser_off (Optional[np.ndarray[np.float64]]): 1D laser on absorption.</span>

<span class="sd">        laser_off (Optional[np.ndarray[np.float64]]): 1D laser off absorption.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
    <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
        <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
    <span class="p">)</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
    <span class="n">normed_xas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">normed_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xas</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">normed_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xas</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

    <span class="n">scan_vals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">scan_vals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

    <span class="n">lxt_fast_scan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
        <span class="n">binned_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">binned_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">binned_xas_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
        <span class="n">binned_xas_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bin_or_bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">scan_vals_las_on</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">scan_vals_las_off</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">binned_xas_las_on</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xas_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">])</span>
            <span class="n">binned_xas_las_off</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xas_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binned_xas_las_on</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">normed_xas_las_on</span><span class="p">[</span><span class="n">scan_vals_las_on</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">binned_xas_las_off</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">normed_xas_las_off</span><span class="p">[</span><span class="n">scan_vals_las_off</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned_xas_las_on</span> <span class="o">-</span> <span class="n">binned_xas_las_off</span>
    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">binned_xas_las_on</span><span class="p">,</span> <span class="n">binned_xas_las_off</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_scan_binned_difference_xes</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the binned difference emission.</p>
<p>Calculates the difference emission for each bin of a scan variable.
Final difference shape is 2D: (pixels, scan_bins) where the pixel
axis is energy.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bins</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of scan bins used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>diff</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference emission.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D laser on emission.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_off</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D laser off emission.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference emission.</span>

<span class="sd">    Calculates the difference emission for each bin of a scan variable.</span>
<span class="sd">    Final difference shape is 2D: (pixels, scan_bins) where the pixel</span>
<span class="sd">    axis is energy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bins (np.ndarray[np.float64]): 1D array of scan bins used.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference emission.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 2D laser on emission.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 2D laser off emission.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
    <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
        <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
    <span class="p">)</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span>
    <span class="n">normed_xes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">normed_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xes</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">normed_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed_xes</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

    <span class="n">scan_vals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">scan_vals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>

    <span class="n">lxt_fast_scan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
        <span class="n">binned_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">normed_xes_las_on</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">binned_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">normed_xes_las_off</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">binned_xes_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">normed_xes_las_on</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">binned_xes_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">normed_xes_las_off</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bin_or_bin_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lxt_fast_scan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">scan_vals_las_on</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">scan_vals_las_off</span> <span class="o">&gt;=</span> <span class="n">bin_or_bin_edge</span>
            <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">scan_vals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">binned_xes_las_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normed_xes_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">binned_xes_las_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">normed_xes_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binned_xes_las_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">normed_xes_las_on</span><span class="p">[</span><span class="n">scan_vals_las_on</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">binned_xes_las_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">normed_xes_las_off</span><span class="p">[</span><span class="n">scan_vals_las_off</span> <span class="o">==</span> <span class="n">bin_or_bin_edge</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">binned_xes_las_on</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
        <span class="n">binned_xes_las_off</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">binned_xes_las_on</span><span class="p">,</span> <span class="n">binned_xes_las_off</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_scan_binned_difference_xss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_scan_binned_difference_xss</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the binned difference scattering.</p>
<p>Calculates the 1D difference scattering for each bin of a scan variable.
Final difference shape is 2D: (q_bins, scan_bins). Also returns bins and
the laser on profiles.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bins</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of scan bins used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>diff</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D binned difference scattering of shape
(q_bins, scan_bins)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>laser_on</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D laser on scattering profiles
of shape (n_events_las_on, q_bins)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_scan_binned_difference_xss</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the binned difference scattering.</span>

<span class="sd">    Calculates the 1D difference scattering for each bin of a scan variable.</span>
<span class="sd">    Final difference shape is 2D: (q_bins, scan_bins). Also returns bins and</span>
<span class="sd">    the laser on profiles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bins (np.ndarray[np.float64]): 1D array of scan bins used.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D binned difference scattering of shape</span>
<span class="sd">            (q_bins, scan_bins)</span>

<span class="sd">        laser_on (np.ndarray[np.float64]): 2D laser on scattering profiles</span>
<span class="sd">            of shape (n_events_las_on, q_bins)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">profiles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dark_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_xss_dark_mean</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dark_mean</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Can be len == 1 if all nan</span>
        <span class="n">profiles</span> <span class="o">-=</span> <span class="n">dark_mean</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_norm_by_qrange</span><span class="p">()</span>
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">(</span><span class="n">profiles</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">del</span> <span class="n">dark_mean</span>
    <span class="k">del</span> <span class="n">norm</span>

    <span class="n">filter_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">()</span>
    <span class="n">filter_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_filters</span><span class="p">(</span>
        <span class="n">filter_vars</span><span class="o">=</span><span class="s2">&quot;xray on, laser off, ipm, total scattering&quot;</span>
    <span class="p">)</span>
    <span class="n">normed_xss_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">normed_xss_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_scan_bins</span><span class="p">()</span>
    <span class="n">binned_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)))</span>
    <span class="n">binned_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)))</span>
    <span class="n">scanvals_las_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_on</span><span class="p">]</span>
    <span class="n">scanvals_las_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">[</span><span class="n">filter_las_off</span><span class="p">]</span>

    <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">scan_bin</span><span class="p">:</span> <span class="nb">float</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">scan_bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mask_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scanvals_las_on</span> <span class="o">&gt;=</span> <span class="n">scan_bin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">scanvals_las_on</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">mask_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scanvals_las_off</span> <span class="o">&gt;=</span> <span class="n">scan_bin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">scanvals_las_off</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">binned_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">normed_xss_las_on</span><span class="p">[</span><span class="n">mask_on</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">binned_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">normed_xss_las_off</span><span class="p">[</span><span class="n">mask_off</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binned_on</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                <span class="n">normed_xss_las_on</span><span class="p">[(</span><span class="n">scanvals_las_on</span> <span class="o">==</span> <span class="n">scan_bin</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">binned_off</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                <span class="n">normed_xss_las_off</span><span class="p">[(</span><span class="n">scanvals_las_off</span> <span class="o">==</span> <span class="n">scan_bin</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">binned_on</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
        <span class="n">binned_off</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">normed_xss_las_on</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_scan_bins" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_scan_bins</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">51</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate a set of scan bins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nbins</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins to create.</p>
              </div>
            </td>
            <td>
                  <code>51</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>scan_bins</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of scan bins.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_scan_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">51</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate a set of scan bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        nbins (int): Number of bins to create.</span>

<span class="sd">    Returns:</span>
<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of scan bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a full set of scan values</span>
    <span class="n">all_scan_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Allgatherv</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">all_scan_values</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_events_per_rank</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_indices_per_rank</span><span class="p">,</span>
            <span class="n">MPI</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">all_scan_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">)</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_scan_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scan_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">scan_bins</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._calc_xss_dark_mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_calc_xss_dark_mean</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the dark (X-ray off) mean of a set of XSS profiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>profiles</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of profiles to calculate the
dark mean from. Shape: (n_events, q_bins)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    dark_mean (np.ndarray[np.float64]): The calculated dark mean.
        Shape: (q_bins)</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_calc_xss_dark_mean</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">profiles</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the dark (X-ray off) mean of a set of XSS profiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        profiles (np.ndarray[np.float64]): Set of profiles to calculate the</span>
<span class="sd">            dark mean from. Shape: (n_events, q_bins)</span>
<span class="sd">    Returns:</span>
<span class="sd">        dark_mean (np.ndarray[np.float64]): The calculated dark mean.</span>
<span class="sd">            Shape: (q_bins)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dark_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dark_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">profiles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray off&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dark_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">dark_mean</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
        <span class="n">dark_mean</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_size</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;No X-ray off event information for filtering. &quot;</span>
            <span class="s2">&quot;Dark mean will be all zeros.&quot;</span>
        <span class="p">)</span>
        <span class="n">dark_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dark_mean</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._convolution_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_convolution_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fits a time scan through convolution with Heaviside kernel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
scattering profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference signal of shape
(q_bins, scan_bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>raw_curve</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference slice at a specific
Q value used for calculating the overlap.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>trace</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D convolution trace.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>center</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the center from the convolution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>fwhm</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the convlution signal (fwhm).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_convolution_fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fits a time scan through convolution with Heaviside kernel.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            scattering profile.</span>

<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">            (q_bins, scan_bins).</span>

<span class="sd">    Returns:</span>
<span class="sd">        raw_curve (np.ndarray[np.float64]): 1D difference slice at a specific</span>
<span class="sd">            Q value used for calculating the overlap.</span>

<span class="sd">        trace (np.ndarray[np.float64]): 1D convolution trace.</span>

<span class="sd">        center (int): The index of the center from the convolution.</span>

<span class="sd">        fwhm (float): Width of the convlution signal (fwhm).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">fftconvolve</span>

    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_solvent_argmax</span><span class="p">(</span><span class="n">laser_on</span><span class="p">)</span>
    <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">max_pt</span> <span class="o">+</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">npts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">)</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">npts</span><span class="p">])</span>
    <span class="n">kernel</span><span class="p">[:</span> <span class="n">npts</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
    <span class="n">fwhm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_convolution_fwhm</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">fwhm</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_az_int" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_az_int</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Try to extract the azimuthal integration data from HDF5 file.</p>
<p>This internal method will search first to see if a detector has been
provided as the scattering detector. If not, it will attempt to guess
which detector to use. It will attempt to extract both the internal
integration data and PyFAI integrated data (which have different
interfaces). If both are present, it will only extract the internal
algorithm data.</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_az_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to extract the azimuthal integration data from HDF5 file.</span>

<span class="sd">    This internal method will search first to see if a detector has been</span>
<span class="sd">    provided as the scattering detector. If not, it will attempt to guess</span>
<span class="sd">    which detector to use. It will attempt to extract both the internal</span>
<span class="sd">    integration data and PyFAI integrated data (which have different</span>
<span class="sd">    interfaces). If both are present, it will only extract the internal</span>
<span class="sd">    algorithm data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xss_detname</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int_smd_internal</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Extracted internal azimuthal integration data for </span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int_pyfai</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extracted PyFAI azimuthal integration data for </span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No azimuthal integration data found.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_comm</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_az_int_pyfai" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_az_int_pyfai</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract stored data from PyFAI's azimuthal integration algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detname</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detector name to extract data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_az_int_pyfai</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract stored data from PyFAI&#39;s azimuthal integration algorithm.</span>

<span class="sd">    Args:</span>
<span class="sd">        detname (str): The detector name to extract data for.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_azav&quot;</span><span class="p">][</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
    <span class="p">]</span>  <span class="c1"># 3D</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_q&quot;</span><span class="p">][()][</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_phi_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/pyfai_az&quot;</span><span class="p">][()][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_az_int_smd_internal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_az_int_smd_internal</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract stored data from SmallData's azimuthal integration algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detname</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detector name to extract data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_az_int_smd_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract stored data from SmallData&#39;s azimuthal integration algorithm.</span>

<span class="sd">    Args:</span>
<span class="sd">        detname (str): The detector name to extract data for.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav_azav&quot;</span><span class="p">][</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
    <span class="p">]</span>  <span class="c1"># 3D</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;UserDataCfg/</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav__azav_q&quot;</span><span class="p">][()]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_phi_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;UserDataCfg/</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/azav__azav_phiVec&quot;</span><span class="p">][()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_standard_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_standard_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Setup up stored attributes by taking data from the smalldata hdf5 file.</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_standard_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup up stored attributes by taking data from the smalldata hdf5 file.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_az_int</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ipm_var</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ipm data not found! Check config!&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_integrated_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_az_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_std_filters</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">scan_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;scan/</span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="n">scan_var</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan variable </span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2"> not found!&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">scan_var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">scan_var</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;scan/</span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="n">scan_var</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan variable </span><span class="si">{</span><span class="n">scan_var</span><span class="si">}</span><span class="s2"> not found!&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_scan_values&quot;</span><span class="p">):</span>
        <span class="c1"># Create a set of scan values if none of the above scan</span>
        <span class="c1"># variables are found, either lxt_fast or linear set.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;enc/lasDelay&quot;</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="o">=</span> <span class="s2">&quot;lxt_fast&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using scan variable lxt_fast&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scan variable lxt_fast not found!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No scans found, using linearly spaced data for _scan_values.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_xas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_xas</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract XAS specific data.</p>
<p>Extracts the integrated sum of an ROI as well as an CCM position data.
Will search for both the readback value PV and, if present, the setpoint
PV.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detname</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detector name to extract data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_xas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract XAS specific data.</span>

<span class="sd">    Extracts the integrated sum of an ROI as well as an CCM position data.</span>
<span class="sd">    Will search for both the readback value PV and, if present, the setpoint</span>
<span class="sd">    PV.</span>

<span class="sd">    Args:</span>
<span class="sd">        detname (str): The detector name to extract data for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xas_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_sum&quot;</span><span class="p">][</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm</span><span class="p">][</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccm_E_set_pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">ccm_set</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No ccm_E_setpoint data. Will use fallback binning.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_element</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">element</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._extract_xes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_extract_xes</span><span class="p">(</span><span class="n">detname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract XAS specific data.</p>
<p>Extracts individual ROIs and applys projections to extract the XES
spectra. Depending on input TaskParameters, it will optionally rotate
each ROI by some degrees prior to projection.</p>
<p>By default, this method will read all ROIs into memory simultaneously
and then project them. Alternatively, e.g. if encountering memory issues,
input parameters can be changed to switch to reading in batches. Set the
<code>batch_size</code> parameter to indicate the number of events to read into memory
at once.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detname</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detector name to extract data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_extract_xes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract XAS specific data.</span>

<span class="sd">    Extracts individual ROIs and applys projections to extract the XES</span>
<span class="sd">    spectra. Depending on input TaskParameters, it will optionally rotate</span>
<span class="sd">    each ROI by some degrees prior to projection.</span>

<span class="sd">    By default, this method will read all ROIs into memory simultaneously</span>
<span class="sd">    and then project them. Alternatively, e.g. if encountering memory issues,</span>
<span class="sd">    input parameters can be changed to switch to reading in batches. Set the</span>
<span class="sd">    `batch_size` parameter to indicate the number of events to read into memory</span>
<span class="sd">    at once.</span>

<span class="sd">    Args:</span>
<span class="sd">        detname (str): The detector name to extract data for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lets assume they set up the ROI nicley?</span>
    <span class="c1"># By xcsl1004821</span>
    <span class="c1"># proj0 should be spatial distribution</span>
    <span class="c1"># proj1 should be XES (unless invert == True)</span>
    <span class="n">spatial_axis</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">spectral_axis</span><span class="p">:</span> <span class="nb">int</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
        <span class="n">spatial_axis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">spectral_axis</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spatial_axis</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">spectral_axis</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
        <span class="c1"># Read data in batches for OOM issues</span>
        <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">batch_size</span>

        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
            <span class="n">end</span><span class="p">:</span> <span class="nb">int</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span>
            <span class="n">xes_roi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_area&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">,</span> <span class="n">xes_roi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">rotate</span>

                <span class="n">xes_roi</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">spatial_dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="n">xes_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">guess_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">spatial_dist</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">xes_roi</span><span class="p">[:,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xes_roi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">detname</span><span class="si">}</span><span class="s2">/ROI_0_area&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">rotate</span>

            <span class="n">xes_roi</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">xes_roi</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">rot_angle</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">spatial_dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
            <span class="n">xes_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spatial_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">guess_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">spatial_dist</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">invert_xes_axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="n">xes_roi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="n">xes_roi</span><span class="p">[:,</span> <span class="n">guess_idx</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">guess_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="n">spectral_axis</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._find_solvent_argmax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_find_solvent_argmax</span><span class="p">(</span><span class="n">corrected_profile</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find the index of the solvent ring maximum.</p>
<p>Currently just a hack around SciPy find_peaks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>corrected_profile</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D normalized and dark
mean corrected, laser on, scattering profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>peak_idx</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index where the solvent maximum is located.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_find_solvent_argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corrected_profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the index of the solvent ring maximum.</span>

<span class="sd">    Currently just a hack around SciPy find_peaks.</span>

<span class="sd">    Args:</span>
<span class="sd">        corrected_profile (np.ndarray[np.float64]): 1D normalized and dark</span>
<span class="sd">            mean corrected, laser on, scattering profile.</span>

<span class="sd">    Returns:</span>
<span class="sd">        peak_idx (int): The index where the solvent maximum is located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">find_peaks</span><span class="p">(</span><span class="n">corrected_profile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">peak_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">peak_heights</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No peaks found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">corrected_profile</span><span class="p">)</span>

    <span class="n">peak_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">peak_indices</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peak_heights</span><span class="p">)</span>
    <span class="p">]</span>  <span class="c1"># peak_indices[0]  # peak_indices[peak_select - 1]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_solvent_peak_idx</span> <span class="o">=</span> <span class="n">peak_idx</span>
    <span class="k">return</span> <span class="n">peak_idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._fit_convolution_fwhm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_fit_convolution_fwhm</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the FWHM of a convolution signal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>trace</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D convolution trace.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>fwhm</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Calculated FWHM.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_convolution_fwhm</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the FWHM of a convolution signal.</span>

<span class="sd">    Args:</span>
<span class="sd">        trace (np.ndarray[np.float64]): 1D convolution trace.</span>

<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fwhm (float): Calculated FWHM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">))</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">trace</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">spline</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">lb</span><span class="p">,</span> <span class="n">rb</span> <span class="o">=</span> <span class="n">roots</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="n">rb</span> <span class="o">-</span> <span class="n">lb</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">guess</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">x0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_val</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
        <span class="n">opt</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
            <span class="n">gaussian</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">999999</span>
        <span class="p">)</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="n">sigma_to_fwhm</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">fwhm</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._fit_overlap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_fit_overlap</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fit overlap based on scattering difference signal to a Gaussian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
scattering profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference signal of shape
(q_bins, scan_bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guess</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of initial parameter guesses
for Gaussian fit in the order (amplitude, x0, sigma, background
offset)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>raw_curve</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference slice at a specific
Q value used for calculating the overlap.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>opt</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimized parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>res</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Covariances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_fit_overlap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">guess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit overlap based on scattering difference signal to a Gaussian.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            scattering profile.</span>

<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">            (q_bins, scan_bins).</span>

<span class="sd">        guess (Optional[List[float]]): A list of initial parameter guesses</span>
<span class="sd">            for Gaussian fit in the order (amplitude, x0, sigma, background</span>
<span class="sd">            offset)</span>

<span class="sd">    Returns:</span>
<span class="sd">        raw_curve (np.ndarray[np.float64]): 1D difference slice at a specific</span>
<span class="sd">            Q value used for calculating the overlap.</span>

<span class="sd">        opt (np.ndarray[np.float64]): Optimized parameters.</span>

<span class="sd">        res (np.ndarray[np.float64]): Covariances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
    <span class="n">max_pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_solvent_argmax</span><span class="p">(</span><span class="n">laser_on</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">idx_peak_q</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">max_pt</span> <span class="o">+</span> <span class="mi">10</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">: No non-nan values found.&quot;</span><span class="p">)</span>
        <span class="n">idx_peak_q</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span>

    <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">diff</span><span class="p">[</span><span class="n">idx_peak_q</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">guess</span><span class="p">:</span>
        <span class="n">max_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">raw_curve</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">raw_curve</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="c1"># guess = [amplitude, center, stddev, bkgnd]</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="n">max_val</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">raw_curve</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">raw_curve</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
        <span class="n">guess</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">raw_curve</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">opt</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">gaussian</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">999999</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2"> No non-nan values...&quot;</span><span class="p">)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">guess</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._setup_std_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_setup_std_filters</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Setup the individual standard event filters.</p>
<p>Sets up light status (X-ray and laser) filters, and adjustable filters
based on, e.g., thresholds.</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_setup_std_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup the individual standard event filters.</span>

<span class="sd">    Sets up light status (X-ray and laser) filters, and adjustable filters</span>
<span class="sd">    based on, e.g., thresholds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># For filtering based on event type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/xray&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;laser on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/laser&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;xray off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/xray&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;laser off&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smd_h5</span><span class="p">[</span><span class="s2">&quot;lightStatus/laser&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_idx</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="c1"># Create scattering and ipm thresholds for first time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_filters</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData._update_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_update_filters</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update stored event filters that are based on adjustable parameters.</p>
<p>E.g. update the minimum scattering intensity to use in analyses.</p>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_update_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update stored event filters that are based on adjustable parameters.</span>

<span class="sd">    E.g. update the minimum scattering intensity to use in analyses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scattering_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">min_Iscat</span>
    <span class="n">ipm_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">min_ipm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;total scattering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_integrated_intensity</span> <span class="o">&gt;</span> <span class="n">scattering_thresh</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_xray_intensity&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;ipm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xray_intensity</span> <span class="o">&gt;</span> <span class="n">ipm_thresh</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_dict</span><span class="p">[</span><span class="s2">&quot;ipm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_events</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_all_xas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_all_xas</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot XAS and optionally EXAFS</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ccm_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All plots in separated tabs in a pn.Tabs object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_all_xas</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">ccm_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot XAS and optionally EXAFS</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        ccm_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): All plots in separated tabs in a pn.Tabs object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">std_xas_grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_std_xas_hv</span><span class="p">(</span>
        <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span>
    <span class="p">)</span>
    <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">std_xas_grid</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="p">,</span> <span class="s2">&quot;analyze_exafs&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_parameters</span><span class="o">.</span><span class="n">analyze_exafs</span>
    <span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># exafs_grid: pn.GridSpec = self.plot_exafs_hv()</span>
        <span class="c1"># tabs.append(exafs_grid)</span>

    <span class="k">return</span> <span class="n">tabs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_all_xss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_all_xss</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">scan_var_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot all relevant scattering plots.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
scattering profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference signal of shape
(q_bins, scan_bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_var_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the scan variable (for titles, etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All plots in separated tabs in a pn.Tabs object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_all_xss</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot all relevant scattering plots.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            scattering profile.</span>

<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">            (q_bins, scan_bins).</span>

<span class="sd">        scan_var_name (str): Name of the scan variable (for titles, etc.).</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): All plots in separated tabs in a pn.Tabs object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># avg_fig = self.plot_avg_xss()</span>
    <span class="n">overlap_fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xss_overlap_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

    <span class="c1"># avg_grid = pn.GridSpec(name=&quot;TR X-ray Scattering&quot;)</span>
    <span class="c1"># avg_grid[:2, :2] = avg_fig</span>

    <span class="n">diff_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_difference_xss_hv</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">scan_var_name</span><span class="p">)</span>
    <span class="n">overlap_grid</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overlap Fit&quot;</span><span class="p">)</span>
    <span class="n">overlap_grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlap_fig</span>

    <span class="n">tabbed_display</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">diff_grid</span><span class="p">)</span>
    <span class="n">tabbed_display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap_grid</span><span class="p">)</span>
    <span class="c1"># tabbed_display.append(avg_grid)</span>

    <span class="k">return</span> <span class="n">tabbed_display</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_difference_xss_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_difference_xss_hv</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">scan_var_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the binned difference scattering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q_vals</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of Q bins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference signal of shape
(q_bins, scan_bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_var_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the scan variable (for titles, etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.GridSpec">GridSpec</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_difference_xss_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">q_vals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the binned difference scattering.</span>

<span class="sd">    Args:</span>
<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        q_vals (np.ndarray[np.float64]): 1D set of Q bins.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">            (q_bins, scan_bins).</span>

<span class="sd">        scan_var_name (str): Name of the scan variable (for titles, etc.).</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.GridSpec): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference Profiles&quot;</span><span class="p">)</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;scan_var&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Scan Var </span><span class="si">{</span><span class="n">scan_var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">))</span>
    <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
        <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">contours</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">contours</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Q&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dS&quot;</span><span class="p">,</span> <span class="s2">&quot;dS&quot;</span><span class="p">))</span>
    <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span>
    <span class="n">diff_curves</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">q_vals</span><span class="p">,</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">q_vals</span><span class="p">,</span>
                    <span class="n">diff</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_std_xas_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_std_xas_hv</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot relevant XAS plots.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ccm_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.GridSpec">GridSpec</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Laser on/off and difference XAS plots.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_std_xas_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">ccm_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot relevant XAS plots.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        ccm_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.GridSpec): Laser on/off and difference XAS plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;ccm_E&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">))</span>

    <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
    <span class="p">)</span>
    <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
    <span class="p">)</span>
    <span class="n">xas_plots</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

    <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;dA/dE&quot;</span><span class="p">))</span>

    <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">ccm_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span>
    <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span><span class="p">([</span><span class="n">diff_pts</span><span class="p">,</span> <span class="n">diff_curve</span><span class="p">])</span>

    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;XAS&quot;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span>
    <span class="k">return</span> <span class="n">grid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_std_xes_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_std_xes_hv</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot XES and difference XES.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>energy_bins</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used
for the energy axis. If None, will just use pixels for that axis.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference emission.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_std_xes_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">energy_bins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot XES and difference XES.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        energy_bins (Optional[np.ndarray[np.float64]]): 1D set of bins used</span>
<span class="sd">            for the energy axis. If None, will just use pixels for that axis.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">))</span>

    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">energy_bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># May be float, above is int</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">energy_bins</span>

    <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
    <span class="p">)</span>
    <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
    <span class="p">)</span>
    <span class="n">xes_plots</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

    <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff I&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

    <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span>
    <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span><span class="p">([</span><span class="n">diff_pts</span><span class="p">,</span> <span class="n">diff_curve</span><span class="p">])</span>

    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;XES&quot;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xes_plots</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span>
    <span class="k">return</span> <span class="n">grid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xas_lxt_fast_scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xas_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Produce a plot of an lxt_fast scan for time zero (or real signal).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xas_lxt_fast_scan</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce a plot of an lxt_fast scan for time zero (or real signal).</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt_fast&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt_fast&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Normalized A&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalized A&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scan_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">scan_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">xas_plots</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

    <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;diff A&quot;</span><span class="p">))</span>
    <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
        <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on - Laser off&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
    <span class="p">)</span>
    <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_pts</span> <span class="o">*</span> <span class="n">diff_curve</span>

    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lxt_fast T0 scan&quot;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xas_power_titration_scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xas_power_titration_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Produce a plot of the lxe_opa power titration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xas_power_titration_scan</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce a plot of the lxe_opa power titration.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxe_opa&quot;</span><span class="p">,</span> <span class="s2">&quot;lxe_opa&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Normalized A&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalized A&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">on_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">on_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_on</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="n">off_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser off&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">off_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
    <span class="p">)</span>
    <span class="n">xas_plots</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">on_pts</span> <span class="o">*</span> <span class="n">on_curve</span> <span class="o">*</span> <span class="n">off_pts</span> <span class="o">*</span> <span class="n">off_curve</span>

    <span class="n">ydim</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;diff A&quot;</span><span class="p">,</span> <span class="s2">&quot;diff A&quot;</span><span class="p">))</span>
    <span class="n">diff_pts</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Points</span><span class="p">(</span>
        <span class="p">(</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span>
        <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Laser on - Laser off&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">diff_curve</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">),</span> <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">])</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
    <span class="p">)</span>
    <span class="n">diff_plot</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_pts</span> <span class="o">*</span> <span class="n">diff_curve</span>

    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Power Titration&quot;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xas_plots</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_plot</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">axiswise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xas_scan_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xas_scan_hv</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot scan binned XAS data.</p>
<p>Currently handles lxe_opa power titration and t0 (lxt_fast) XAS scans.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
absorption spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference absorption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xas_scan_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot scan binned XAS data.</span>

<span class="sd">    Currently handles lxe_opa power titration and t0 (lxt_fast) XAS scans.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            absorption spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference absorption.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Skipping scan plots - requested scan variables not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;lxe_opa&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xas_power_titration_scan</span><span class="p">(</span>
            <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xas_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xes_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xes_hv</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot XES and difference XES. In the future will provide other plots.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>energy_bins</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used
for the energy axis. If None, will just use pixels for that axis.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference emission.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xes_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">energy_bins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot XES and difference XES. In the future will provide other plots.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        energy_bins (Optional[np.ndarray[np.float64]]): 1D set of bins used</span>
<span class="sd">            for the energy axis. If None, will just use pixels for that axis.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">std_xes_grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_std_xes_hv</span><span class="p">(</span>
        <span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">diff</span>
    <span class="p">)</span>
    <span class="n">tabs</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">std_xes_grid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tabs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_fast_scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xes_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot lxt_fast scan binned XES data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference emission.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xes_lxt_fast_scan</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot lxt_fast scan binned XES data.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference XES&quot;</span><span class="p">)</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt_fast&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt_fast&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">bin_centers</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">scan_bins</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">scan_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">bin_centers</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
            <span class="n">diff</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">contours</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Contours</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">contours</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared</span>

    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dI&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

    <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span>
            <span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xes_lxt_scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xes_lxt_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot lxt scan binned XES data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference emission.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="panel.Tabs">Tabs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xes_lxt_scan</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot lxt scan binned XES data.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (pn.Tabs): Plotted binned difference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid</span><span class="p">:</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Difference XES&quot;</span><span class="p">)</span>
    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;lxt&quot;</span><span class="p">,</span> <span class="s2">&quot;lxt&quot;</span><span class="p">))</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">diff_img</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">scan_bins</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">laser_on</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
            <span class="n">diff</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">kdims</span><span class="o">=</span><span class="p">[</span><span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">contours</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Contours</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">contours</span><span class="p">(</span><span class="n">diff_img</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">contours</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
        <span class="n">hv</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">Contours</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;fire&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">325</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Overlay</span> <span class="o">=</span> <span class="n">diff_img</span> <span class="o">+</span> <span class="n">contours</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared</span>

    <span class="n">xdim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (Pixel)&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ydim</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimension</span><span class="o">.</span><span class="n">Dimension</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Dimension</span><span class="p">((</span><span class="s2">&quot;dI&quot;</span><span class="p">,</span> <span class="s2">&quot;dI&quot;</span><span class="p">))</span>

    <span class="n">diff_curves</span><span class="p">:</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scan_bins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_curves</span> <span class="o">*=</span> <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">diff</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">xdim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ydim</span><span class="o">.</span><span class="n">label</span>
            <span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">diff_curves</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">shared_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xes_scan_hv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xes_scan_hv</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot scan binned XES data.</p>
<p>Currently handles lxt and lxt_fast XES scans.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>laser_off</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser off
emission spectrum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D difference emission.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="panel.Tabs">Tabs</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted binned difference. Returns None if
the scan variable is unknown/unrecognized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xes_scan_hv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">laser_off</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">scan_bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">Tabs</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot scan binned XES data.</span>

<span class="sd">    Currently handles lxt and lxt_fast XES scans.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        laser_off (np.ndarray[np.float64]): 1D corrected average laser off</span>
<span class="sd">            emission spectrum.</span>

<span class="sd">        scan_bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 1D difference emission.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (Optional[pn.Tabs]): Plotted binned difference. Returns None if</span>
<span class="sd">            the scan variable is unknown/unrecognized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping scan plots - requested scan variables not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;lxt_fast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xes_lxt_fast_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;lxt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_xes_lxt_scan</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">laser_off</span><span class="p">,</span> <span class="n">scan_bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tasks._smalldata.AnalyzeSmallData.plot_xss_overlap_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_xss_overlap_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the overlap fit to a slice of the binned difference.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laser_on</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D corrected average laser on
scattering profile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bins</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D set of bins used for difference
signal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>diff</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span>[<span title="numpy.float64">float64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D difference signal of shape
(q_bins, scan_bins).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>plot</code></td>            <td>
                  <code><span title="matplotlib.pyplot.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotted overlap fit.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lute/tasks/_smalldata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_xss_overlap_fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">laser_on</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
    <span class="n">diff</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the overlap fit to a slice of the binned difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        laser_on (np.ndarray[np.float64]): 1D corrected average laser on</span>
<span class="sd">            scattering profile.</span>

<span class="sd">        bins (np.ndarray[np.float64]): 1D set of bins used for difference</span>
<span class="sd">            signal.</span>

<span class="sd">        diff (np.ndarray[np.float64]): 2D difference signal of shape</span>
<span class="sd">            (q_bins, scan_bins).</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot (plt.Figure): Plotted overlap fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;lxt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="p">:</span>
        <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="n">trace</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="n">center</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">fwhm</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">raw_curve</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">fwhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convolution_fit</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Scan Var: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Overlap Position: </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">center</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;FWHM: </span><span class="si">{</span><span class="n">fwhm</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw&quot;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Convolution&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan Variable (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$S&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_curve</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="n">opt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
        <span class="n">raw_curve</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_overlap</span><span class="p">(</span><span class="n">laser_on</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Scan Var: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Overlap Position: </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;FWHM: </span><span class="si">{</span><span class="n">sigma_to_fwhm</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">raw_curve</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">opt</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan Variable (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_var_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$S&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2024 LCLS
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>